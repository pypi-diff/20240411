# Comparing `tmp/pangu_kits_app_dev_py-2.0.0-py3-none-any.whl.zip` & `tmp/pangu_kits_app_dev_py-2.1.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,167 +1,167 @@
-Zip file size: 130364 bytes, number of entries: 165
--rw-------  2.0 unx      210 b- defN 24-Feb-27 01:52 pangukitsappdev/__init__.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/agent/__init__.py
--rw-------  2.0 unx      938 b- defN 24-Feb-27 01:52 pangukitsappdev/agent/agent_action.py
--rw-------  2.0 unx      951 b- defN 24-Feb-27 01:52 pangukitsappdev/agent/agent_session.py
--rw-------  2.0 unx     7441 b- defN 24-Feb-27 01:52 pangukitsappdev/agent/react_agent.py
--rw-------  2.0 unx     9995 b- defN 24-Feb-27 01:52 pangukitsappdev/agent/react_pangu_agent.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/__init__.py
--rw-------  2.0 unx     4713 b- defN 24-Feb-27 01:52 pangukitsappdev/api/common_config.py
--rw-------  2.0 unx     8007 b- defN 24-Feb-27 01:52 pangukitsappdev/api/config_loader.py
--rw-------  2.0 unx     2857 b- defN 24-Feb-27 01:52 pangukitsappdev/api/crypto_util.py
--rw-------  2.0 unx      260 b- defN 24-Feb-27 01:52 pangukitsappdev/api/schema.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/agent/__init__.py
--rw-------  2.0 unx    20212 b- defN 24-Feb-27 01:52 pangukitsappdev/api/agent/base.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/doc_split/__init__.py
--rw-------  2.0 unx      984 b- defN 24-Feb-27 01:52 pangukitsappdev/api/doc_split/base.py
--rw-------  2.0 unx     1648 b- defN 24-Feb-27 01:52 pangukitsappdev/api/doc_split/factory.py
--rw-------  2.0 unx     1276 b- defN 24-Feb-27 01:52 pangukitsappdev/api/doc_split/split_config.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/embeddings/__init__.py
--rw-------  2.0 unx     1634 b- defN 24-Feb-27 01:52 pangukitsappdev/api/embeddings/base.py
--rw-------  2.0 unx      963 b- defN 24-Feb-27 01:52 pangukitsappdev/api/embeddings/embedding_config.py
--rw-------  2.0 unx     2490 b- defN 24-Feb-27 01:52 pangukitsappdev/api/embeddings/factory.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/llms/__init__.py
--rw-------  2.0 unx    10915 b- defN 24-Feb-27 01:52 pangukitsappdev/api/llms/base.py
--rw-------  2.0 unx     2521 b- defN 24-Feb-27 01:52 pangukitsappdev/api/llms/factory.py
--rw-------  2.0 unx     5710 b- defN 24-Feb-27 01:52 pangukitsappdev/api/llms/llm_config.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/__init__.py
--rw-------  2.0 unx     1068 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/message_history_config.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/cache/__init__.py
--rw-------  2.0 unx     1858 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/cache/base.py
--rw-------  2.0 unx     2836 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/cache/cache_config.py
--rw-------  2.0 unx     2780 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/cache/factory.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/vector/__init__.py
--rw-------  2.0 unx     4295 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/vector/base.py
--rw-------  2.0 unx     2025 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/vector/factory.py
--rw-------  2.0 unx     2093 b- defN 24-Feb-27 01:52 pangukitsappdev/api/memory/vector/vector_config.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/prompt/__init__.py
--rw-------  2.0 unx     4486 b- defN 24-Feb-27 01:52 pangukitsappdev/api/prompt/prompt_config.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/retriever/__init__.py
--rw-------  2.0 unx     4645 b- defN 24-Feb-27 01:52 pangukitsappdev/api/retriever/base.py
--rw-------  2.0 unx      757 b- defN 24-Feb-27 01:52 pangukitsappdev/api/retriever/retriever_config.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/skill/__init__.py
--rw-------  2.0 unx     1654 b- defN 24-Feb-27 01:52 pangukitsappdev/api/skill/base.py
--rw-------  2.0 unx      640 b- defN 24-Feb-27 01:52 pangukitsappdev/api/skill/factory.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/api/tool/__init__.py
--rw-------  2.0 unx     3202 b- defN 24-Feb-27 01:52 pangukitsappdev/api/tool/base.py
--rw-------  2.0 unx        0 b- defN 24-Feb-27 01:52 pangukitsappdev/auth/__init__.py
--rw-------  2.0 unx     5998 b- defN 24-Feb-27 01:52 pangukitsappdev/auth/iam.py
--rw-------  2.0 unx        0 b- defN 24-Feb-27 01:52 pangukitsappdev/cache/__init__.py
--rw-------  2.0 unx     6087 b- defN 24-Feb-27 01:52 pangukitsappdev/cache/gptcache_adapter.py
--rw-------  2.0 unx     1626 b- defN 24-Feb-27 01:52 pangukitsappdev/cache/in_memory.py
--rw-------  2.0 unx     5086 b- defN 24-Feb-27 01:52 pangukitsappdev/cache/sql.py
--rw-------  2.0 unx     3708 b- defN 24-Feb-27 01:52 pangukitsappdev/cache/ttl_redis.py
--rw-------  2.0 unx      828 b- defN 24-Feb-27 01:52 pangukitsappdev/callback/DebugConsoleCallbackHandler.py
--rw-------  2.0 unx     1230 b- defN 24-Feb-27 01:52 pangukitsappdev/callback/StreamCallbackHandler.py
--rw-------  2.0 unx        0 b- defN 24-Feb-27 01:52 pangukitsappdev/callback/__init__.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/doc_split/__init__.py
--rw-------  2.0 unx     3525 b- defN 24-Feb-27 01:52 pangukitsappdev/doc_split/pangu_split.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/embeddings/__init__.py
--rw-------  2.0 unx     1026 b- defN 24-Feb-27 01:52 pangukitsappdev/embeddings/openai.py
--rw-------  2.0 unx     4767 b- defN 24-Feb-27 01:52 pangukitsappdev/embeddings/pangu.py
--rw-------  2.0 unx     1776 b- defN 24-Feb-27 01:52 pangukitsappdev/embeddings/tool.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/__init__.py
--rw-------  2.0 unx    11922 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/gallery.py
--rw-------  2.0 unx     2703 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/openai.py
--rw-------  2.0 unx    12941 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/pangu.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/response/__init__.py
--rw-------  2.0 unx     1225 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/response/gallery_text_resp.py
--rw-------  2.0 unx      391 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/response/llm_response_gallery.py
--rw-------  2.0 unx      384 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/response/llm_response_openai.py
--rw-------  2.0 unx      378 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/response/llm_response_pangu.py
--rw-------  2.0 unx      778 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/response/openai_text_resp.py
--rw-------  2.0 unx     1203 b- defN 24-Feb-27 01:52 pangukitsappdev/llms/response/pangu_text_resp.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/memory/__init__.py
--rw-------  2.0 unx     1426 b- defN 24-Feb-27 01:52 pangukitsappdev/memory/conversation_summory_memory.py
--rw-------  2.0 unx     1024 b- defN 24-Feb-27 01:52 pangukitsappdev/memory/redis_message_history.py
--rw-------  2.0 unx     4229 b- defN 24-Feb-27 01:52 pangukitsappdev/memory/sql_message_history.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/__init__.py
--rw-------  2.0 unx     3192 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompt_tmpl.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/__init__.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/__init__.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/__init__.py
--rw-------  2.0 unx     1463 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/react.pt
--rw-------  2.0 unx      601 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/react_pangu.pt
--rw-------  2.0 unx      703 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/react_pangu_2.pt
--rw-------  2.0 unx      709 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/react_pangu_unify.pt
--rw-------  2.0 unx      188 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/tool_desc.pt
--rw-------  2.0 unx      116 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/tool_desc_pangu.pt
--rw-------  2.0 unx       58 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/tool_desc_pangu_2.pt
--rw-------  2.0 unx       68 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/tool_json_schema.pt
--rw-------  2.0 unx       25 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/agent/tool_simple_schema.pt
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/conversation/__init__.py
--rw-------  2.0 unx      245 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/conversation/default.pt
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/__init__.py
--rw-------  2.0 unx      128 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/mapreduce_map.pt
--rw-------  2.0 unx      754 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/mapreduce_reduce.pt
--rw-------  2.0 unx      220 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/refine_combine.pt
--rw-------  2.0 unx      186 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/refine_qa.pt
--rw-------  2.0 unx      409 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/stuff.pt
--rw-------  2.0 unx       67 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/summarize_mapreduce_map.pt
--rw-------  2.0 unx      150 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/summarize_mapreduce_reduce.pt
--rw-------  2.0 unx      312 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/summarize_refine_combine.pt
--rw-------  2.0 unx       67 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/summarize_refine_qa.pt
--rw-------  2.0 unx      150 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/documents/summarize_stuff.pt
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/memory/__init__.py
--rw-------  2.0 unx      611 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/memory/summary.pt
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/question/__init__.py
--rw-------  2.0 unx      221 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/question/long_answer.jinja2
--rw-------  2.0 unx      351 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/question/qa_with_sources_stuff.jinja2
--rw-------  2.0 unx      201 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/question/question_only.jinja2
--rw-------  2.0 unx      236 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/question/short_answer.jinja2
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/skill/__init__.py
--rw-------  2.0 unx      307 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/skill/agent_session_summary.pt
--rw-------  2.0 unx      221 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/skill/conversation_rewrite.pt
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/system/__init__.py
--rw-------  2.0 unx      460 b- defN 24-Feb-27 01:52 pangukitsappdev/prompt/prompts/default/system/out_put_parser.pt
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/qa_with_sources/__init__.py
--rw-------  2.0 unx     1426 b- defN 24-Feb-27 01:52 pangukitsappdev/qa_with_sources/refine_prompt.py
--rw-------  2.0 unx     1245 b- defN 24-Feb-27 01:52 pangukitsappdev/qa_with_sources/retrieval.py
--rw-------  2.0 unx      670 b- defN 24-Feb-27 01:52 pangukitsappdev/qa_with_sources/stuff_prompt.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/retriever/__init__.py
--rw-------  2.0 unx     1666 b- defN 24-Feb-27 01:52 pangukitsappdev/retriever/css_tool_retriever.py
--rw-------  2.0 unx      547 b- defN 24-Feb-27 01:52 pangukitsappdev/retriever/kg_retriever.py
--rw-------  2.0 unx      318 b- defN 24-Feb-27 01:52 pangukitsappdev/retriever/retrieved_tool.py
--rw-------  2.0 unx      417 b- defN 24-Feb-27 01:52 pangukitsappdev/retriever/tool_metadata.py
--rw-------  2.0 unx     1623 b- defN 24-Feb-27 01:52 pangukitsappdev/retriever/tool_retriever_impl.py
--rw-------  2.0 unx      410 b- defN 24-Feb-27 01:52 pangukitsappdev/retriever/web_retirever.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/__init__.py
--rw-------  2.0 unx     1126 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/agent_session_skill.py
--rw-------  2.0 unx     1005 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/conversation_rewrite_skill.py
--rw-------  2.0 unx     1584 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/conversation_skill.py
--rw-------  2.0 unx     1225 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/factory.py
--rw-------  2.0 unx      395 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/qa_with_sources.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/doc/__init__.py
--rw-------  2.0 unx     1001 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/doc/ask.py
--rw-------  2.0 unx     5631 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/doc/base.py
--rw-------  2.0 unx     1065 b- defN 24-Feb-27 01:52 pangukitsappdev/skill/doc/summary.py
--rw-------  2.0 unx        0 b- defN 24-Feb-27 01:52 pangukitsappdev/stores/__init__.py
--rw-------  2.0 unx     8170 b- defN 24-Feb-27 01:52 pangukitsappdev/stores/obs_store.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/__init__.py
--rw-------  2.0 unx     1133 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/in_memory_tool_provider.py
--rw-------  2.0 unx      335 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/python_sandbox.py
--rw-------  2.0 unx     5064 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/tool.py
--rw-------  2.0 unx      678 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/tool_provider.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/buildin/__init__.py
--rw-------  2.0 unx      942 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/buildin/python_interpreter.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/unify/__init__.py
--rw-------  2.0 unx      871 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/unify/unify_python_interpreter.py
--rw-------  2.0 unx     2028 b- defN 24-Feb-27 01:52 pangukitsappdev/tool/unify/unify_web_search.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/utilities/__init__.py
--rw-------  2.0 unx     2341 b- defN 24-Feb-27 01:52 pangukitsappdev/utilities/kg.py
--rw-------  2.0 unx      411 b- defN 24-Feb-27 01:52 pangukitsappdev/utilities/knowledge_graph.py
--rw-------  2.0 unx     1787 b- defN 24-Feb-27 01:52 pangukitsappdev/utilities/petal_search.py
--rw-------  2.0 unx      449 b- defN 24-Feb-27 01:52 pangukitsappdev/utilities/web_search.py
--rw-------  2.0 unx       79 b- defN 24-Feb-27 01:52 pangukitsappdev/utils/__init__.py
--rw-------  2.0 unx     1094 b- defN 24-Feb-27 01:52 pangukitsappdev/utils/security_util.py
--rw-------  2.0 unx      929 b- defN 24-Feb-27 01:52 pangukitsappdev/utils/time_date.py
--rw-------  2.0 unx        0 b- defN 24-Feb-27 01:52 pangukitsappdev/vectorstores/__init__.py
--rw-------  2.0 unx     1109 b- defN 24-Feb-27 01:52 pangukitsappdev/vectorstores/adapter.py
--rw-------  2.0 unx      324 b- defN 24-Feb-27 01:52 pangukitsappdev/vectorstores/bulk_data.py
--rw-------  2.0 unx    16585 b- defN 24-Feb-27 01:52 pangukitsappdev/vectorstores/css_store.py
--rw-------  2.0 unx      592 b- defN 24-Feb-27 01:52 pangukitsappdev/vectorstores/proxy_http_requests.py
--rw-------  2.0 unx     1081 b- defN 24-Feb-27 01:53 pangu_kits_app_dev_py-2.0.0.dist-info/METADATA
--rw-------  2.0 unx       92 b- defN 24-Feb-27 01:53 pangu_kits_app_dev_py-2.0.0.dist-info/WHEEL
--rw-------  2.0 unx       16 b- defN 24-Feb-27 01:53 pangu_kits_app_dev_py-2.0.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx    16626 b- defN 24-Feb-27 01:53 pangu_kits_app_dev_py-2.0.0.dist-info/RECORD
-165 files, 289678 bytes uncompressed, 102956 bytes compressed:  64.5%
+Zip file size: 131106 bytes, number of entries: 165
+-rw-------  2.0 unx      210 b- defN 24-Apr-10 08:50 pangukitsappdev/__init__.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/agent/__init__.py
+-rw-------  2.0 unx      890 b- defN 24-Apr-10 08:50 pangukitsappdev/agent/agent_action.py
+-rw-------  2.0 unx      888 b- defN 24-Apr-10 08:50 pangukitsappdev/agent/agent_session.py
+-rw-------  2.0 unx     6604 b- defN 24-Apr-10 08:50 pangukitsappdev/agent/react_agent.py
+-rw-------  2.0 unx     9127 b- defN 24-Apr-10 08:50 pangukitsappdev/agent/react_pangu_agent.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/__init__.py
+-rw-------  2.0 unx     4773 b- defN 24-Apr-10 08:50 pangukitsappdev/api/common_config.py
+-rw-------  2.0 unx     8007 b- defN 24-Apr-10 08:50 pangukitsappdev/api/config_loader.py
+-rw-------  2.0 unx     2857 b- defN 24-Apr-10 08:50 pangukitsappdev/api/crypto_util.py
+-rw-------  2.0 unx      260 b- defN 24-Apr-10 08:50 pangukitsappdev/api/schema.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/agent/__init__.py
+-rw-------  2.0 unx    22187 b- defN 24-Apr-10 08:50 pangukitsappdev/api/agent/base.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/doc_split/__init__.py
+-rw-------  2.0 unx      984 b- defN 24-Apr-10 08:50 pangukitsappdev/api/doc_split/base.py
+-rw-------  2.0 unx     1648 b- defN 24-Apr-10 08:50 pangukitsappdev/api/doc_split/factory.py
+-rw-------  2.0 unx     1276 b- defN 24-Apr-10 08:50 pangukitsappdev/api/doc_split/split_config.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/embeddings/__init__.py
+-rw-------  2.0 unx     1634 b- defN 24-Apr-10 08:50 pangukitsappdev/api/embeddings/base.py
+-rw-------  2.0 unx      963 b- defN 24-Apr-10 08:50 pangukitsappdev/api/embeddings/embedding_config.py
+-rw-------  2.0 unx     2490 b- defN 24-Apr-10 08:50 pangukitsappdev/api/embeddings/factory.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/llms/__init__.py
+-rw-------  2.0 unx    11476 b- defN 24-Apr-10 08:50 pangukitsappdev/api/llms/base.py
+-rw-------  2.0 unx     2521 b- defN 24-Apr-10 08:50 pangukitsappdev/api/llms/factory.py
+-rw-------  2.0 unx     5710 b- defN 24-Apr-10 08:50 pangukitsappdev/api/llms/llm_config.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/__init__.py
+-rw-------  2.0 unx     1068 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/message_history_config.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/cache/__init__.py
+-rw-------  2.0 unx     1864 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/cache/base.py
+-rw-------  2.0 unx     2836 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/cache/cache_config.py
+-rw-------  2.0 unx     2780 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/cache/factory.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/vector/__init__.py
+-rw-------  2.0 unx     4295 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/vector/base.py
+-rw-------  2.0 unx     2025 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/vector/factory.py
+-rw-------  2.0 unx     2093 b- defN 24-Apr-10 08:50 pangukitsappdev/api/memory/vector/vector_config.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/prompt/__init__.py
+-rw-------  2.0 unx     4486 b- defN 24-Apr-10 08:50 pangukitsappdev/api/prompt/prompt_config.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/retriever/__init__.py
+-rw-------  2.0 unx     4633 b- defN 24-Apr-10 08:50 pangukitsappdev/api/retriever/base.py
+-rw-------  2.0 unx      757 b- defN 24-Apr-10 08:50 pangukitsappdev/api/retriever/retriever_config.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/skill/__init__.py
+-rw-------  2.0 unx     2461 b- defN 24-Apr-10 08:50 pangukitsappdev/api/skill/base.py
+-rw-------  2.0 unx      640 b- defN 24-Apr-10 08:50 pangukitsappdev/api/skill/factory.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/api/tool/__init__.py
+-rw-------  2.0 unx     3202 b- defN 24-Apr-10 08:50 pangukitsappdev/api/tool/base.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/auth/__init__.py
+-rw-------  2.0 unx     6119 b- defN 24-Apr-10 08:50 pangukitsappdev/auth/iam.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/cache/__init__.py
+-rw-------  2.0 unx     6087 b- defN 24-Apr-10 08:50 pangukitsappdev/cache/gptcache_adapter.py
+-rw-------  2.0 unx     1562 b- defN 24-Apr-10 08:50 pangukitsappdev/cache/in_memory.py
+-rw-------  2.0 unx     5120 b- defN 24-Apr-10 08:50 pangukitsappdev/cache/sql.py
+-rw-------  2.0 unx     3741 b- defN 24-Apr-10 08:50 pangukitsappdev/cache/ttl_redis.py
+-rw-------  2.0 unx      828 b- defN 24-Apr-10 08:50 pangukitsappdev/callback/DebugConsoleCallbackHandler.py
+-rw-------  2.0 unx     1230 b- defN 24-Apr-10 08:50 pangukitsappdev/callback/StreamCallbackHandler.py
+-rw-------  2.0 unx        0 b- defN 24-Apr-10 08:50 pangukitsappdev/callback/__init__.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/doc_split/__init__.py
+-rw-------  2.0 unx     3525 b- defN 24-Apr-10 08:50 pangukitsappdev/doc_split/pangu_split.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/embeddings/__init__.py
+-rw-------  2.0 unx     1022 b- defN 24-Apr-10 08:50 pangukitsappdev/embeddings/openai.py
+-rw-------  2.0 unx     4767 b- defN 24-Apr-10 08:50 pangukitsappdev/embeddings/pangu.py
+-rw-------  2.0 unx     1776 b- defN 24-Apr-10 08:50 pangukitsappdev/embeddings/tool.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/__init__.py
+-rw-------  2.0 unx    12094 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/gallery.py
+-rw-------  2.0 unx     2691 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/openai.py
+-rw-------  2.0 unx    13081 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/pangu.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/response/__init__.py
+-rw-------  2.0 unx     1225 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/response/gallery_text_resp.py
+-rw-------  2.0 unx      391 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/response/llm_response_gallery.py
+-rw-------  2.0 unx      384 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/response/llm_response_openai.py
+-rw-------  2.0 unx      378 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/response/llm_response_pangu.py
+-rw-------  2.0 unx      778 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/response/openai_text_resp.py
+-rw-------  2.0 unx     1203 b- defN 24-Apr-10 08:50 pangukitsappdev/llms/response/pangu_text_resp.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/memory/__init__.py
+-rw-------  2.0 unx     1426 b- defN 24-Apr-10 08:50 pangukitsappdev/memory/conversation_summory_memory.py
+-rw-------  2.0 unx     1024 b- defN 24-Apr-10 08:50 pangukitsappdev/memory/redis_message_history.py
+-rw-------  2.0 unx     4229 b- defN 24-Apr-10 08:50 pangukitsappdev/memory/sql_message_history.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/__init__.py
+-rw-------  2.0 unx     3192 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompt_tmpl.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/__init__.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/__init__.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/__init__.py
+-rw-------  2.0 unx     1481 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/react.pt
+-rw-------  2.0 unx      695 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/react_pangu.pt
+-rw-------  2.0 unx      740 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/react_pangu_2.pt
+-rw-------  2.0 unx      709 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/react_pangu_unify.pt
+-rw-------  2.0 unx      188 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/tool_desc.pt
+-rw-------  2.0 unx      116 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/tool_desc_pangu.pt
+-rw-------  2.0 unx       58 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/tool_desc_pangu_2.pt
+-rw-------  2.0 unx       68 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/tool_json_schema.pt
+-rw-------  2.0 unx       25 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/agent/tool_simple_schema.pt
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/conversation/__init__.py
+-rw-------  2.0 unx      245 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/conversation/default.pt
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/__init__.py
+-rw-------  2.0 unx      128 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/mapreduce_map.pt
+-rw-------  2.0 unx      754 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/mapreduce_reduce.pt
+-rw-------  2.0 unx      220 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/refine_combine.pt
+-rw-------  2.0 unx      186 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/refine_qa.pt
+-rw-------  2.0 unx      409 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/stuff.pt
+-rw-------  2.0 unx       67 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/summarize_mapreduce_map.pt
+-rw-------  2.0 unx      150 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/summarize_mapreduce_reduce.pt
+-rw-------  2.0 unx      312 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/summarize_refine_combine.pt
+-rw-------  2.0 unx       67 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/summarize_refine_qa.pt
+-rw-------  2.0 unx      150 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/documents/summarize_stuff.pt
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/memory/__init__.py
+-rw-------  2.0 unx      611 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/memory/summary.pt
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/question/__init__.py
+-rw-------  2.0 unx      221 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/question/long_answer.jinja2
+-rw-------  2.0 unx      351 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/question/qa_with_sources_stuff.jinja2
+-rw-------  2.0 unx      201 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/question/question_only.jinja2
+-rw-------  2.0 unx      236 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/question/short_answer.jinja2
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/skill/__init__.py
+-rw-------  2.0 unx      307 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/skill/agent_session_summary.pt
+-rw-------  2.0 unx      221 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/skill/conversation_rewrite.pt
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/system/__init__.py
+-rw-------  2.0 unx      460 b- defN 24-Apr-10 08:50 pangukitsappdev/prompt/prompts/default/system/out_put_parser.pt
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/qa_with_sources/__init__.py
+-rw-------  2.0 unx     1426 b- defN 24-Apr-10 08:50 pangukitsappdev/qa_with_sources/refine_prompt.py
+-rw-------  2.0 unx     1245 b- defN 24-Apr-10 08:50 pangukitsappdev/qa_with_sources/retrieval.py
+-rw-------  2.0 unx      670 b- defN 24-Apr-10 08:50 pangukitsappdev/qa_with_sources/stuff_prompt.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/retriever/__init__.py
+-rw-------  2.0 unx     1666 b- defN 24-Apr-10 08:50 pangukitsappdev/retriever/css_tool_retriever.py
+-rw-------  2.0 unx      547 b- defN 24-Apr-10 08:50 pangukitsappdev/retriever/kg_retriever.py
+-rw-------  2.0 unx      318 b- defN 24-Apr-10 08:50 pangukitsappdev/retriever/retrieved_tool.py
+-rw-------  2.0 unx      417 b- defN 24-Apr-10 08:50 pangukitsappdev/retriever/tool_metadata.py
+-rw-------  2.0 unx     1623 b- defN 24-Apr-10 08:50 pangukitsappdev/retriever/tool_retriever_impl.py
+-rw-------  2.0 unx      410 b- defN 24-Apr-10 08:50 pangukitsappdev/retriever/web_retirever.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/__init__.py
+-rw-------  2.0 unx     1281 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/agent_session_skill.py
+-rw-------  2.0 unx      993 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/conversation_rewrite_skill.py
+-rw-------  2.0 unx     1593 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/conversation_skill.py
+-rw-------  2.0 unx     1225 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/factory.py
+-rw-------  2.0 unx      395 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/qa_with_sources.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/doc/__init__.py
+-rw-------  2.0 unx     1001 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/doc/ask.py
+-rw-------  2.0 unx     5692 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/doc/base.py
+-rw-------  2.0 unx     1065 b- defN 24-Apr-10 08:50 pangukitsappdev/skill/doc/summary.py
+-rw-------  2.0 unx        0 b- defN 24-Apr-10 08:50 pangukitsappdev/stores/__init__.py
+-rw-------  2.0 unx     8170 b- defN 24-Apr-10 08:50 pangukitsappdev/stores/obs_store.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/__init__.py
+-rw-------  2.0 unx     1133 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/in_memory_tool_provider.py
+-rw-------  2.0 unx      335 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/python_sandbox.py
+-rw-------  2.0 unx     5064 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/tool.py
+-rw-------  2.0 unx      678 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/tool_provider.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/buildin/__init__.py
+-rw-------  2.0 unx      942 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/buildin/python_interpreter.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/unify/__init__.py
+-rw-------  2.0 unx      871 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/unify/unify_python_interpreter.py
+-rw-------  2.0 unx     2028 b- defN 24-Apr-10 08:50 pangukitsappdev/tool/unify/unify_web_search.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/utilities/__init__.py
+-rw-------  2.0 unx     2341 b- defN 24-Apr-10 08:50 pangukitsappdev/utilities/kg.py
+-rw-------  2.0 unx      411 b- defN 24-Apr-10 08:50 pangukitsappdev/utilities/knowledge_graph.py
+-rw-------  2.0 unx     1787 b- defN 24-Apr-10 08:50 pangukitsappdev/utilities/petal_search.py
+-rw-------  2.0 unx      449 b- defN 24-Apr-10 08:50 pangukitsappdev/utilities/web_search.py
+-rw-------  2.0 unx       79 b- defN 24-Apr-10 08:50 pangukitsappdev/utils/__init__.py
+-rw-------  2.0 unx     1094 b- defN 24-Apr-10 08:50 pangukitsappdev/utils/security_util.py
+-rw-------  2.0 unx      929 b- defN 24-Apr-10 08:50 pangukitsappdev/utils/time_date.py
+-rw-------  2.0 unx        0 b- defN 24-Apr-10 08:50 pangukitsappdev/vectorstores/__init__.py
+-rw-------  2.0 unx     1109 b- defN 24-Apr-10 08:50 pangukitsappdev/vectorstores/adapter.py
+-rw-------  2.0 unx      324 b- defN 24-Apr-10 08:50 pangukitsappdev/vectorstores/bulk_data.py
+-rw-------  2.0 unx    16585 b- defN 24-Apr-10 08:50 pangukitsappdev/vectorstores/css_store.py
+-rw-------  2.0 unx      592 b- defN 24-Apr-10 08:50 pangukitsappdev/vectorstores/proxy_http_requests.py
+-rw-------  2.0 unx     1148 b- defN 24-Apr-10 08:50 pangu_kits_app_dev_py-2.1.0.dist-info/METADATA
+-rw-------  2.0 unx       92 b- defN 24-Apr-10 08:50 pangu_kits_app_dev_py-2.1.0.dist-info/WHEEL
+-rw-------  2.0 unx       16 b- defN 24-Apr-10 08:50 pangu_kits_app_dev_py-2.1.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx    16627 b- defN 24-Apr-10 08:50 pangu_kits_app_dev_py-2.1.0.dist-info/RECORD
+165 files, 292267 bytes uncompressed, 103698 bytes compressed:  64.5%
```

## zipnote {}

```diff
@@ -477,20 +477,20 @@
 
 Filename: pangukitsappdev/vectorstores/css_store.py
 Comment: 
 
 Filename: pangukitsappdev/vectorstores/proxy_http_requests.py
 Comment: 
 
-Filename: pangu_kits_app_dev_py-2.0.0.dist-info/METADATA
+Filename: pangu_kits_app_dev_py-2.1.0.dist-info/METADATA
 Comment: 
 
-Filename: pangu_kits_app_dev_py-2.0.0.dist-info/WHEEL
+Filename: pangu_kits_app_dev_py-2.1.0.dist-info/WHEEL
 Comment: 
 
-Filename: pangu_kits_app_dev_py-2.0.0.dist-info/top_level.txt
+Filename: pangu_kits_app_dev_py-2.1.0.dist-info/top_level.txt
 Comment: 
 
-Filename: pangu_kits_app_dev_py-2.0.0.dist-info/RECORD
+Filename: pangu_kits_app_dev_py-2.1.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## pangukitsappdev/agent/agent_action.py

```diff
@@ -1,11 +1,9 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from typing import Any, Optional
-
-from pangukitsappdev.api.schema import LLMResp
 from pydantic import BaseModel
 
 
 class AgentAction(BaseModel):
     """
     Agent执行的action
     Attributes:
```

## pangukitsappdev/agent/agent_session.py

```diff
@@ -1,27 +1,25 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from typing import Optional, List
 
-from langchain.schema import BaseMessage
+from pangukitsappdev.api.llms.base import ConversationMessage
 from pydantic import BaseModel
 from pangukitsappdev.agent.agent_action import AgentAction
 
 
 class AgentSession(BaseModel):
     """
     Agent运行Session，包含历史Action，当前Action，状态
     Attributes:
         messages: 本次session的用户的输入
         session_id: UUID，在一个session内唯一
-        final_answer: Agent返回的最终答案（最后一个AgentAction的输出）
-        history_action: 历史Action
         current_action: 当前Action
         agent_session_status: Agent状态
         is_by_step: 是否是逐步执行
+        current_message: 当前的AssistantMessage
     """
-    messages: List[BaseMessage]
+    messages: List[ConversationMessage]
     session_id: str
-    final_answer: Optional[str]
-    history_action: List[AgentAction]
     current_action: Optional[AgentAction]
     agent_session_status: str
     is_by_step: Optional[bool]
+    current_message: Optional[ConversationMessage]
```

## pangukitsappdev/agent/react_agent.py

```diff
@@ -3,15 +3,15 @@
 import json
 import logging
 from json import JSONDecodeError
 from pydantic import ValidationError
 from pangukitsappdev.agent.agent_action import AgentAction
 from pangukitsappdev.agent.agent_session import AgentSession
 from pangukitsappdev.api.agent.base import AbstractAgent, AgentSessionHelper
-from pangukitsappdev.api.llms.base import LLMApi, to_message_in_req
+from pangukitsappdev.api.llms.base import LLMApi
 from pangukitsappdev.prompt.prompt_tmpl import PromptTemplates
 
 logger = logging.getLogger(__name__)
 
 
 class ReactAgent(AbstractAgent):
     PLACEHOLDER_THOUGHT = "Thought:"
@@ -19,49 +19,29 @@
     PLACEHOLDER_OBSERVATION = "Observation:"
     DEFAULT_SYS_PROMPT = "您是一个智能助手，尽可能有帮助和准确地回答用户提出的问题"
 
     def __init__(self, llm: LLMApi):
         super(ReactAgent, self).__init__(llm)
 
     def react(self, agent_session: AgentSession):
-        actions = agent_session.history_action
         # 超过最大迭代次数限制，不再执行
         if self.need_interrupt(agent_session):
             return
 
         # 构造React prompt
         react_tp = PromptTemplates.get("agent_react")
-        actions_list = []
-        for action in actions:
-            action_dict = action.dict(exclude_none=True, exclude={"action_json", "action_input", "user_feedback"})
-            if action.action_json:
-                action_dict["actionJson"] = action.action_json
-            if action.action_input:
-                action_dict["actionInput"] = action.action_input
-            if action.user_feedback:
-                action_dict["userFeedBack"] = action.user_feedback
-            actions_list.append(action_dict)
-
-        messages = []
-        for message in agent_session.messages:
-            msg_dict = to_message_in_req(message)
-            messages.append({'role': {'text': msg_dict.get('role'),
-                                      'desc': self.convert_role_to_desc(msg_dict.get('role'))},
-                             'content': msg_dict.get('content')})
 
+        messages = agent_session.messages
         sys_prompt = self.get_system_prompt(
             agent_session) if self.get_system_prompt(agent_session) is not None else self.DEFAULT_SYS_PROMPT
         final_prompt = react_tp.format(sys_prompt=sys_prompt,
                                        tool_desc=self.get_tool_desc(),
                                        tool_names=self.get_tool_names(),
-                                       messages=messages,
-                                       actions=actions_list)
-
+                                       messages=self.convert_message_to_dict(messages))
         # 获取action
-
         if self.llm.get_llm_config().llm_param_config.stream:
             tokens = self.llm.ask(final_prompt)
             answer = ""
             for token in tokens:
                 answer += token
         else:
             answer = self.llm.ask(final_prompt).answer
@@ -82,17 +62,19 @@
             try:
                 self.tool_execute(tool, action.action_input, agent_session)
             except ValidationError:
                 logger.debug("agent did not return a valid tool input, input=%s, but tool need %s",
                              action.action_input, tool.input_type)
                 raise ValueError("agent did not return a valid tool input")
 
-            logger.info("actions = %s", "\n".join([action.json(ensure_ascii=False) for action in actions]))
+            logger.info("actions = %s", "\n".join([action.json(ensure_ascii=False)
+                                                   for action in agent_session.current_message.actions]))
         else:
-            self.notice_session_end(agent_session)
+            self.notice_session_end(agent_session, action)
+
     def get_action(self, answer: str) -> AgentAction:
         # 获取第一个action
         action_str = self.sub_str_before(self.sub_str_after(answer, self.PLACEHOLDER_ACTION),
                                          self.PLACEHOLDER_OBSERVATION)
         if not action_str:
             action_str = self.sub_str_before(answer, self.PLACEHOLDER_OBSERVATION)
         agent_action = self.get_agent_action(action_str)
```

## pangukitsappdev/agent/react_pangu_agent.py

```diff
@@ -6,15 +6,15 @@
 
 from langchain.prompts import PromptTemplate
 from pydantic.typing import NoneType
 
 from pangukitsappdev.agent.agent_action import AgentAction
 from pangukitsappdev.agent.agent_session import AgentSession
 from pangukitsappdev.api.agent.base import AbstractAgent, AgentSessionHelper
-from pangukitsappdev.api.llms.base import LLMApi, to_message_in_req
+from pangukitsappdev.api.llms.base import LLMApi
 from pangukitsappdev.prompt.prompt_tmpl import PromptTemplates
 
 logger = logging.getLogger(__name__)
 
 
 class ReactPanguAgent(AbstractAgent):
     DEFAULT_SYS_PROMPT = "你的名字叫智子，是由华为开发的智能助手"
@@ -52,46 +52,27 @@
         else:
             llm_module_property.unify_tag_prefix = "[unused9]"
             llm_module_property.unify_tag_suffix = "[unused10]"
             llm_module_property.unify_tool_tag_prefix = "[unused11]"
             llm_module_property.unify_tool_tag_suffix = "[unused12]"
 
     def react(self, agent_session: AgentSession):
-        actions = agent_session.history_action
         # 超过最大迭代次数限制，不再执行
         if self.need_interrupt(agent_session):
             return
 
         # 构造React prompt
         react_tp = self.get_react_template()
-        actions_list = []
-        for action in actions:
-            action_dict = action.dict(exclude_none=True, exclude={"action_json", "action_input", "user_feedback"})
-            if action.action_json:
-                action_dict["actionJson"] = action.action_json
-            if action.action_input:
-                action_dict["actionInput"] = action.action_input
-            if action.user_feedback:
-                action_dict["userFeedBack"] = action.user_feedback
-            actions_list.append(action_dict)
-
-        messages = []
-        for message in agent_session.messages:
-            msg_dict = to_message_in_req(message)
-            messages.append({'role': {'text': msg_dict.get('role'),
-                                      'desc': self.convert_role_to_desc(msg_dict.get('role'))},
-                             'content': msg_dict.get('content')})
-
+        messages = agent_session.messages
         default_sys_prompt = self.DEFAULT_SYS_PROMPT if self.is_plugin_v1_version(self.get_template_version()) else ""
         sys_prompt = self.get_system_prompt(
             agent_session) if self.get_system_prompt(agent_session) is not None else default_sys_prompt
         final_prompt = react_tp.format(sys_prompt=sys_prompt,
                                        tool_desc=self.get_tool_desc(),
-                                       messages=messages,
-                                       actions=actions_list)
+                                       messages=self.convert_message_to_dict(messages))
         normalize_prompt = self.normalize_prompt_template(final_prompt)
         # 调用llm
         if self.llm.get_llm_config().llm_param_config.stream:
             tokens = self.llm.ask(normalize_prompt)
             answer = ""
             for token in tokens:
                 answer += token
@@ -115,15 +96,15 @@
         if tool_id == "":
             action = AgentAction(req=normalize_prompt,
                                  resp=answer,
                                  thought=answer,
                                  action=AgentSessionHelper.FINAL_ACTION,
                                  action_input=answer)
             agent_session.current_action = action
-            self.notice_session_end(agent_session)
+            self.notice_session_end(agent_session, action)
             return
         tool = self.get_tool(tool_id)
         action = AgentAction(req=normalize_prompt,
                              resp=answer,
                              thought=self.sub_str_before(answer, llm_module_property.unify_tool_tag_prefix),
                              action_json="",
                              action=tool_id)
@@ -144,15 +125,16 @@
             else:
                 tool_input = json.loads(action.action_input)
         except JSONDecodeError:
             tool_input = action.action_input
 
         # 执行工具
         self.tool_execute(tool, tool_input, agent_session)
-        logger.info("actions = %s", "\n".join([action.json(ensure_ascii=False) for action in actions]))
+        logger.info("actions = %s",
+                    "\n".join([action.json(ensure_ascii=False) for action in agent_session.current_message.actions]))
 
     def get_tool_desc(self):
         return self.get_tool_desc_template().format(tools=[
             {"panguFunction": self.tool_map[tool].get_pangu_function()} for tool in self.tool_map])
 
     def normalize_prompt_template(self, prompt_str: str) -> str:
         """
```

## pangukitsappdev/api/common_config.py

```diff
@@ -67,14 +67,15 @@
     iam_url: Optional[str] = Field(env="url")
     iam_domain: Optional[str] = Field(env="domain")
     iam_user: Optional[str] = Field(env="user")
     iam_pwd: Optional[str] = Field(env="password")
     project_name: Optional[str] = Field(env="project")
     # token过期时间（毫秒），默认23小时，过期后，下一次接口调用会自动获取token
     expire_duration_millis: int = Field(default=23 * 60 * 60 * 1000, env="expireDurationMillis")
+    x_auth_token: Optional[str] = Field(env="x_auth_token")
     http_config: HttpConfig = Field(default_factory=lambda: HttpConfig())
 
 
 class IAMConfigWrapper:
     def __init__(self, env_prefix: str = "sdk.iam"):
         self.env_prefix = env_prefix
```

## pangukitsappdev/api/agent/base.py

```diff
@@ -3,33 +3,33 @@
 
 import json
 import logging
 import uuid
 from abc import ABC, abstractmethod
 from json import JSONDecodeError
 from typing import List, Union, Optional, Dict, Any
-from langchain.schema import BaseMessage, ChatMessage, LLMResult
-from langchain.schema.messages import AIMessageChunk
-from langchain.schema.output import ChatGenerationChunk
+from langchain.schema.messages import AIMessageChunk, BaseMessage
+from langchain.schema.output import ChatGenerationChunk, LLMResult
 from pydantic.json import pydantic_encoder
 
 from pangukitsappdev.api.llms.llm_config import LLMModuleConfig
 from pangukitsappdev.callback.StreamCallbackHandler import StreamCallbackHandler
 from pangukitsappdev.agent.agent_action import AgentAction
 from pangukitsappdev.agent.agent_session import AgentSession
-from pangukitsappdev.api.llms.base import LLMApi, to_message_in_req
+from pangukitsappdev.api.llms.base import LLMApi, ConversationMessage, Role
 from pangukitsappdev.api.retriever.base import ToolRetriever
 from pangukitsappdev.api.tool.base import AbstractTool
 
 logger = logging.getLogger(__name__)
 
 
 class AgentListener(ABC):
     """Agent监听，允许对Agent的各个阶段进行处理
     """
+
     def on_session_start(self, agent_session: AgentSession):
         """
         Session启动时调用
         :param agent_session: AgentSession
         """
 
     def on_session_iteration(self, agent_session: AgentSession):
@@ -76,23 +76,23 @@
         删除所有工具
         """
 
     @abstractmethod
     def run_step(self, agent_session: AgentSession) -> AgentSession:
         """
         单步执行Agent，提供干预能力
-        :param agent_session: 包括初始状态，以及执行步骤间的agentSession，可以使用AgentSessionHelper类辅助处理
+        :param agent_session: 初始状态或运行中状态的agentSession，包括历史消息及其执行步骤，可以使用AgentSessionHelper类辅助处理
         :return: Agent执行的结果
         """
 
     @abstractmethod
-    def run(self, prompt: Union[List[BaseMessage], str]) -> AgentSession:
+    def run(self, user_input: Union[List[ConversationMessage], str, AgentSession]) -> AgentSession:
         """
         递归执行Agent，直到完成所有步骤的执行
-        :param prompt: 用户的输入, 支持多轮List[BaseMessage]或str
+        :param user_input: 用户的输入, 支持多轮List[ConversationMessage]或str或AgentSession
         :return: 计划的结果
         """
 
     @abstractmethod
     def set_max_iterations(self, iterations: int):
         """
         设置最大迭代次数
@@ -132,14 +132,38 @@
         """
         self.llm = llm
         self.tool_map: Dict[str, AbstractTool] = {}
         self.max_iterations = 15
         self.agent_listener: Optional[AgentListener] = None
         self.tool_retriever: Optional[ToolRetriever] = None
 
+    @staticmethod
+    def convert_message_to_dict(conversation_messages: List[ConversationMessage]) -> List[Dict]:
+        # 用于将python命名风格变量适配小驼峰，与Java版本保持prompt模板统一
+        return [
+            {
+                "role": {
+                    "text": message.role.text,
+                    "desc": message.role.desc
+                },
+                "actions": [
+                    {
+                        "req": action.req,
+                        "resp": action.resp,
+                        "thought": action.thought,
+                        "actionJson": action.action_json,
+                        "action": action.action,
+                        "actionInput": action.action_input,
+                        "observation": action.observation,
+                        "userFeedBack": action.user_feedback
+                    } for action in message.actions
+                ],
+                "content": message.content
+            } for message in conversation_messages]
+
     def add_tool(self, tool: AbstractTool):
         tool_id = tool.get_tool_id()
         self.tool_map.update({tool_id: tool})
 
     def remove_tool(self, tool_id: str):
         self.tool_map.pop(tool_id)
 
@@ -159,38 +183,43 @@
             logger.debug("run error when call react", e)
             raise e
 
         if agent_session.agent_session_status != "FINISHED":
             self.notice_session_iteration(agent_session, agent_session.current_action)
         return agent_session
 
-    def run(self, prompt: Union[List[BaseMessage], str]) -> AgentSession:
+    def run(self, user_input: Union[List[ConversationMessage], str, AgentSession]) -> AgentSession:
         """
         执行agent
-        :param prompt: 用户的输入, 支持多轮List[BaseMessage]或str
+        :param user_input: 用户的输入, 支持多轮List[ConversationMessage]或str或AgentSession
         :return: 计划的结果
         """
-        messages = [ChatMessage(role="user", content=prompt)] if isinstance(prompt, str) else prompt
+        agent_session = AgentSessionHelper.init_agent_session(user_input) if \
+            isinstance(user_input, str) or isinstance(user_input, List) else user_input
         # tool检索器处理
-        self.init_tool_from_retriever(messages)
+        self.init_tool_from_retriever(agent_session.messages)
         # 关闭自动添加新的SystemMessage
         self.llm.get_llm_config().llm_module_config.enable_append_system_message = False
-        agent_session = self.notice_session_start(messages)
+        self.notice_session_start(agent_session)
         agent_session.is_by_step = False
+        # 新增一个Assistant回复
+        if agent_session.messages[-1].role.text != "assistant":
+            agent_session.current_message = ConversationMessage(role=Role.ASSISTANT, content="")
+            agent_session.messages.append(agent_session.current_message)
         try:
             self.react(agent_session)
         except (ValueError, JSONDecodeError, TypeError) as e:
             logger.debug("run error when call react", e)
             raise e
 
-        actions = agent_session.history_action
+        # 设置Assistant消息内容
+        AgentSessionHelper.update_assistant_message(agent_session, False)
+        actions = agent_session.current_message.actions
         if actions:
             logger.info(AgentSessionHelper.print_plan(agent_session))
-            if not agent_session.final_answer:
-                agent_session.final_answer = str(actions[-1].action_input)
         return agent_session
 
     @abstractmethod
     def react(self, agent_session: AgentSession):
         """
         迭代解决问题
         :param agent_session: 历史迭代几率
@@ -203,33 +232,31 @@
         if iterations <= 0:
             raise ValueError("iterations value not legal.")
         self.max_iterations = iterations
 
     def set_tool_retriever(self, tool_retriever: ToolRetriever):
         self.tool_retriever = tool_retriever
 
-    def notice_session_start(self, messages: Union[str, BaseMessage]):
-        agent_session = AgentSessionHelper.init_agent_session(messages)
+    def notice_session_start(self, agent_session: AgentSession):
+        agent_session.agent_session_status = "RUNNING"
         if self.agent_listener:
             self.agent_listener.on_session_start(agent_session)
-        return agent_session
 
     def notice_session_iteration(self, agent_session: AgentSession, action: AgentAction):
-        agent_session.history_action.append(action)
+        agent_session.current_message.actions.append(action)
         agent_session.agent_session_status = "RUNNING"
 
         if self.agent_listener:
             self.agent_listener.on_session_iteration(agent_session)
 
-    def notice_session_end(self, agent_session: AgentSession):
+    def notice_session_end(self, agent_session: AgentSession, action: AgentAction):
+        agent_session.current_message.actions.append(action)
         agent_session.agent_session_status = "FINISHED"
         if self.agent_listener:
             self.agent_listener.on_session_end(agent_session)
-        if agent_session.current_action:
-            agent_session.history_action.append(agent_session.current_action)
 
     def tool_execute(self, tool: AbstractTool, tool_input: Union[str, dict], agent_session: AgentSession):
         if agent_session.is_by_step:
             return
         try:
             tool_result = tool.run(tool_input)
         except TypeError:
@@ -279,40 +306,29 @@
     @staticmethod
     def remove_start(origin_str: str, remove: str):
         if origin_str and remove:
             return origin_str[len(remove):] if origin_str.startswith(remove) else origin_str
         else:
             return origin_str
 
-    @staticmethod
-    def convert_role_to_desc(text: str):
-        if text == "user":
-            return "用户"
-        elif text == "assistant":
-            return "助手"
-        elif text == "system":
-            return "系统"
-        else:
-            raise ValueError("Agent message role only support user, assistant or system！")
-
     def need_interrupt(self, agent_session: AgentSession) -> bool:
-        if not agent_session.history_action:
+        if not agent_session.current_message.actions:
             return False
         # 超过最大迭代次数终止
-        if len(agent_session.history_action) >= self.max_iterations:
+        if len(agent_session.current_message.actions) >= self.max_iterations:
             logger.debug("stopped due to iteration limit. maxIterations is %s", self.max_iterations)
             return True
         # 用户终止
         if self.agent_listener and self.agent_listener.on_check_interrupt_requirements(agent_session):
             agent_session.agent_session_status = "INTERRUPTED"
             logger.info("agent stopped due to manual interruption")
             return True
         return False
 
-    def init_tool_from_retriever(self, messages: List[BaseMessage]):
+    def init_tool_from_retriever(self, messages: List[ConversationMessage]):
         if self.tool_retriever is None or messages is None:
             return
         # 处理多轮对话
         preprocessor = self.tool_retriever.get_query_preprocessor()
         query = preprocessor(messages)
         tools = self.tool_retriever.search(query)
         self.tool_map.clear()
@@ -322,15 +338,15 @@
     def get_system_prompt(self, agent_session: AgentSession):
         # 优先取设置到的LLM人设
         system_prompt = self.llm.get_llm_config().llm_module_config.system_prompt
         if system_prompt is not None:
             return system_prompt
         # 其次取message中最后一个人设
         for message in reversed(agent_session.messages):
-            if to_message_in_req(message).get("role") == "system":
+            if message.role.text == "system":
                 return message.content
         return None
 
     def set_stream_callback(self, text_stream_callback: StreamCallbackHandler,
                             tool_stream_callback: StreamCallbackHandler):
         self.llm.set_callback(AgentStreamCallBack(text_stream_callback=text_stream_callback,
                                                   tool_stream_callback=tool_stream_callback,
@@ -456,23 +472,39 @@
 class AgentSessionHelper:
     """
     AgentSession辅助类
     """
     FINAL_ACTION = "FINAL_ANSWER"
 
     @staticmethod
-    def init_agent_session(user_message: Union[str, BaseMessage]) -> AgentSession:
+    def init_agent_session(user_message: Union[str, List[ConversationMessage]]) -> AgentSession:
         """
         使用用户消息初始化一个AgentSession
         :param user_message: 用户消息
         :return: agent_session
         """
-        messages = [ChatMessage(role="user", content=user_message)] if isinstance(user_message, str) else user_message
-        return AgentSession(messages=messages, session_id=str(uuid.uuid4()),
-                            history_action=[], agent_session_status="INIT")
+        messages = [ConversationMessage(role=Role.USER,
+                                        content=user_message)] if isinstance(user_message, str) else user_message
+        agent_session = AgentSession(messages=messages, session_id=str(uuid.uuid4()),
+                                     history_action=[], agent_session_status="INIT")
+        # 新增一个Assistant回复
+        agent_session.current_message = ConversationMessage(role=Role.ASSISTANT, content="")
+        agent_session.messages.append(agent_session.current_message)
+        return agent_session
+
+    @staticmethod
+    def update_assistant_message(agent_session: AgentSession, override: bool):
+        """
+        使用当前的action更新AssistantMessage的内容
+        :param agent_session: AgentSession
+        :param override: 是否覆盖已有的内容
+        """
+        if override or not agent_session.current_message.content:
+            agent_session.current_message.content = str(agent_session.current_action.action_input)
+
 
     @staticmethod
     def set_tool_output(agent_session: AgentSession, observation: str):
         """
         向Agent的当前步骤设置工具返回结果
         :param agent_session: AgentSession
         :param observation: 工具返回结果
@@ -491,27 +523,28 @@
     @staticmethod
     def print_plan(agent_session: AgentSession) -> str:
         """
         打印AgentSession
         :param agent_session: AgentSession
         :return: AgentSession的字符串输出
         """
-        log_msg = "\n"
+        log_msg = ""
         for message in agent_session.messages:
-            msg_dict = to_message_in_req(message)
-            log_msg += f"{msg_dict.get('role')}: {msg_dict.get('content')}\n"
-        log_msg += "计划已执行完成,自动编排步骤:"
-        for i, action in enumerate(agent_session.history_action):
-            log_msg += f"\n步骤{i + 1}"
-            if action.thought and action.thought != action.action_input:
-                thought = action.thought.replace("\n", "")
-                log_msg += f":\n思考:{thought}"
-
-            if AgentSessionHelper.FINAL_ACTION == action.action:
-                log_msg += f"\n思考:{action.action_input}"
-            else:
-                log_msg += f"\n行动:使用工具[{action.action}],传入参数{action.action_input}"
-                if action.observation:
-                    log_msg += f"\n工具返回:{action.observation}"
-                if action.user_feedback:
-                    log_msg += f"\n用户反馈:{action.user_feedback}"
+            log_msg += f"\n{message.role.desc}: {message.content}"
+            # 如果为Assistant消息，打印可能存在的Action
+            if message.role.text == "assistant" and message.actions:
+                actions = message.actions
+                for i in range(len(actions)):
+                    log_msg += f"\n - 步骤{i+1}"
+                    action = actions[i]
+                    if action.thought and action.thought != action.action_input:
+                        thought = action.thought.replace("\n", "")
+                        log_msg += f":\n   思考:{thought}"
+                    if action.action == "FINAL_ANSWER":
+                        log_msg += f"\n   答复:{action.action_input}"
+                    else:
+                        log_msg += f"\n   行动:使用工具[{action.action}],传入参数{action.action_input}"
+                        if action.observation:
+                            log_msg += f"\n   工具返回:{action.observation}"
+                        if action.user_feedback:
+                            log_msg += f"\n   用户反馈:{action.user_feedback}"
         return log_msg
```

## pangukitsappdev/api/llms/base.py

```diff
@@ -1,31 +1,77 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 import json
 import logging
 from abc import ABC, abstractmethod
-from typing import Iterator, Type, List, Union
+from enum import Enum
+from typing import Iterator, Type, List, Union, Literal, Optional, Any, Dict
 
 from langchain.callbacks.base import BaseCallbackHandler
 from langchain.chat_models.base import BaseChatModel
-from langchain.schema import LLMResult, BaseMessage, ChatMessage, HumanMessage, AIMessage, SystemMessage
+from langchain.schema import LLMResult, BaseMessage
+from pangukitsappdev.agent.agent_action import AgentAction
 from pydantic import BaseModel
 
 from pangukitsappdev.api.llms.llm_config import LLMParamConfig, LLMConfig
 from pangukitsappdev.api.schema import LLMResp
 from pangukitsappdev.api.memory.cache.base import CacheApi
 from pangukitsappdev.prompt.prompt_tmpl import PromptTemplates
 
 logger = logging.getLogger(__name__)
 
 
+class Role(Enum):
+    SYSTEM = {"text": "system", "desc": "系统"}
+    USER = {"text": "user", "desc": "用户"}
+    ASSISTANT = {"text": "assistant", "desc": "助手"}
+    OBSERVATION = {"text": "observation", "desc": "观察"}
+
+    @property
+    def desc(self):
+        return self.value.get("desc")
+
+    @property
+    def text(self):
+        return self.value.get("text")
+
+
+class ConversationMessage(BaseMessage):
+    """多轮对话信息
+    拓展了tool和actions，可用于Agent使用
+
+    Attributes:
+        role: 对话角色
+        content: 对话内容
+        tools: 工具集
+        actions: 当role为assistant时，采取的actions，如果没有采取任何action，则为空数组
+    """
+    role: Role
+    """The speaker / role of the Message."""
+
+    type: Literal["chat"] = "chat"
+
+    tools: Optional[Any]
+
+    actions: List[AgentAction] = []
+
+
+def convert_message_to_req(messages: List[BaseMessage]) -> List[Dict]:
+    req = []
+    for message in messages:
+        if not isinstance(message, ConversationMessage):
+            raise ValueError("Pangu LLM input message must be inherited from ConversationMessage!")
+        req.append({"role": message.role.text, "content": message.content})
+    return req
+
+
 class LLMApi(ABC):
 
     @abstractmethod
     def ask(self,
-            prompt: Union[str, List[BaseMessage]],
+            prompt: Union[str, List[ConversationMessage]],
             param_config: LLMParamConfig = None) -> Union[LLMResp, Iterator]:
         """
         问答
         :param prompt: 单轮提示词或多轮message list
         :param param_config: (Optional)覆盖llm的原本的参数配置，用来控制llm的返回信息
         :return: LLMResp or Iterator(流式打印)
         """
@@ -87,15 +133,15 @@
         self.llm_config = llm_config
         self.chat_llm = chat_llm if chat_llm else self.create_chat_llm_with()
 
         self.callback_handler = None
         self.cache = cache
 
     def ask(self,
-            prompt: Union[str, List[BaseMessage]],
+            prompt: Union[str, List[ConversationMessage]],
             param_config: LLMParamConfig = None) -> Union[LLMResp, Iterator]:
         # 根据入参LLMParamConfig判断是否是流式打印，返回类型为Iterator[str]
         if param_config and param_config.stream:
             return self._stream(prompt=prompt, param_config=param_config)
 
         # 根据构造器传递的LLMConfig中的LLMParamConfig判断是否是流式打印
         if self.llm_config and self.llm_config.llm_param_config and self.llm_config.llm_param_config.stream:
@@ -159,15 +205,15 @@
         llm_type = type(self.chat_llm)
         return llm_type(**param_config.dict())
 
     def set_callback(self, callback: BaseCallbackHandler):
         self.callback_handler = callback
 
     def _stream(self,
-                prompt: Union[str, List[BaseMessage]],
+                prompt: Union[str, List[ConversationMessage]],
                 param_config: LLMParamConfig = None) -> Iterator[str]:
         local_llm = self.chat_llm if param_config is None else self.create_chat_llm_with(param_config)
         # 尝试从缓存获取响应
         if self.cache and isinstance(prompt, str):
             """缓存命中，直接从缓存中读取，返回size为1的迭代器
             """
             cached_llm_rsp = self.cache.lookup(prompt=prompt)
@@ -204,55 +250,36 @@
             return self.do_create_chat_llm(llm_config)
         else:
             return self.do_create_chat_llm(self.llm_config)
 
     def parse_llm_response(self, llm_result: LLMResult) -> LLMResp:
         return self._parse_llm_response(llm_result)
 
-    def _get_messages(self, prompt: Union[str, List[BaseMessage]]) -> List[BaseMessage]:
-        messages: List[BaseMessage] = []
+    def _get_messages(self, prompt: Union[str, List[ConversationMessage]]) -> List[ConversationMessage]:
+        messages: List[ConversationMessage] = []
         if self.need_add_new_system_message():
-            messages.append(ChatMessage(role="system", content=self.llm_config.llm_module_config.system_prompt))
+            messages.append(ConversationMessage(role=Role.SYSTEM,
+                                                content=self.llm_config.llm_module_config.system_prompt))
         if isinstance(prompt, str):
-            messages.append(ChatMessage(role="user", content=prompt))
+            messages.append(ConversationMessage(role=Role.USER, content=prompt))
         else:
             for msg in prompt:
-                if self.need_add_new_system_message() and to_message_in_req(msg).get('role') == "system":
+                if self.need_add_new_system_message() and msg.role.text == "system":
                     continue
                 messages.append(msg)
         return messages
 
     def get_llm_config(self) -> LLMConfig:
         return self.llm_config
 
     def need_add_new_system_message(self) -> bool:
-        return self.llm_config.llm_module_config.enable_append_system_message and\
+        return self.llm_config.llm_module_config.enable_append_system_message and \
             self.llm_config.llm_module_config.system_prompt is not None
 
 
-def to_message_in_req(message: BaseMessage) -> dict:
-    """
-    将message转换成请求体，当前只识别system的role，其他的message按照顺序组装，依次是user，assistant
-    :param message: 回复或请求的问题
-    :return: 消息体中的dict数据
-    """
-    if isinstance(message, ChatMessage):
-        message_dict = {"role": message.role, "content": message.content}
-    elif isinstance(message, HumanMessage):
-        message_dict = {"role": "user", "content": message.content}
-    elif isinstance(message, AIMessage):
-        message_dict = {"role": "assistant", "content": message.content}
-    elif isinstance(message, SystemMessage):
-        message_dict = {"role": "system", "content": message.content}
-    else:
-        raise ValueError(f"Got unknown type {message}")
-
-    return message_dict
-
-
 def get_llm_params(params: dict) -> dict:
     """
     用于过滤llm api参数
     若配置参数，则返回对应参数字典，否则返回空，用默认参数值
     :param params: llm api支持的参数
     :return: 消息体中的dict数据
     """
```

## pangukitsappdev/api/memory/cache/base.py

```diff
@@ -1,12 +1,11 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from abc import ABC, abstractmethod
 from typing import Optional
-
-from langchain.cache import BaseCache
+from langchain.schema.cache import BaseCache
 from langchain.schema import Generation
 
 from pangukitsappdev.api.schema import LLMResp
 
 
 class CacheApi(ABC):
     """SDK封装的缓存对外接口"""
```

## pangukitsappdev/api/retriever/base.py

```diff
@@ -1,12 +1,11 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from abc import ABC, abstractmethod
 from typing import List, Optional, Callable
-from langchain.schema import BaseMessage
-from pangukitsappdev.api.llms.base import to_message_in_req
+from pangukitsappdev.api.llms.base import ConversationMessage
 from pangukitsappdev.vectorstores.bulk_data import BulkData
 from pangukitsappdev.api.memory.vector.base import VectorApi, Document
 from pangukitsappdev.api.memory.vector.vector_config import VectorStoreConfig
 from pangukitsappdev.tool.tool_provider import ToolProvider
 from pangukitsappdev.api.tool.base import AbstractTool
 from pangukitsappdev.retriever.tool_metadata import ToolMetadata
 from pangukitsappdev.retriever.retrieved_tool import RetrievedTool
@@ -46,23 +45,23 @@
     def remove(self, tool_ids: List[str]):
         """
         删除工具
         :param tool_ids: tools工具
         """
 
     @abstractmethod
-    def set_query_preprocessor(self, preprocessor: Callable[[List[BaseMessage]], str]):
+    def set_query_preprocessor(self, preprocessor: Callable[[List[ConversationMessage]], str]):
         """
         设置query请求的预处理器
         :param preprocessor: 当ToolRetriever被设置在Agent中时，Agent在Retrieve工具前，
         先会调用query预处理器对多轮对话进行改写，如果不设置，默认使用多轮中的最后一轮对话
         """
 
     @abstractmethod
-    def get_query_preprocessor(self) -> Callable[[List[BaseMessage]], str]:
+    def get_query_preprocessor(self) -> Callable[[List[ConversationMessage]], str]:
         """
         获取query请求的预处理器
         :return: query预处理器
         """
 
 
 class AbstractToolRetriever(ToolRetriever, ABC):
@@ -75,28 +74,28 @@
         :param tool_provider: 工具存储
         :param: vector_store_config: 语义向量存储配置
         """
         self.tool_provider: ToolProvider = tool_provider
         self.vector_store_config: VectorStoreConfig = vector_store_config
         self.vector: Optional[VectorApi] = None
 
-        def default_processor(messages: List[BaseMessage]) -> str:
+        def default_processor(messages: List[ConversationMessage]) -> str:
             query = ""
             for message in reversed(messages):
-                if to_message_in_req(message).get("role") == "user":
+                if message.role.text == "user":
                     query = message.content
                     break
             return query
 
-        self.preprocessor: Callable[[List[BaseMessage]], str] = default_processor
+        self.preprocessor: Callable[[List[ConversationMessage]], str] = default_processor
 
-    def set_query_preprocessor(self, preprocessor: Callable[[List[BaseMessage]], str]):
+    def set_query_preprocessor(self, preprocessor: Callable[[List[ConversationMessage]], str]):
         self.preprocessor = preprocessor
 
-    def get_query_preprocessor(self) -> Callable[[List[BaseMessage]], str]:
+    def get_query_preprocessor(self) -> Callable[[List[ConversationMessage]], str]:
         return self.preprocessor
 
     def add_tools_from_metadata(self, tool_metadata_list: List[ToolMetadata]):
         bulk_data_list = [BulkData(id=tool_metadata.tool_id,
                                    data=tool_metadata.tool_metadata) for tool_metadata in tool_metadata_list]
         self.vector.add_docs(bulk_data_list)
```

## pangukitsappdev/api/skill/base.py

```diff
@@ -1,42 +1,62 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from abc import ABC, abstractmethod
-from typing import Any, Dict
+from typing import Any, Dict, Union, List
 
 from langchain.schema.prompt_template import BasePromptTemplate
 from langchain.chains.llm import LLMChain
 
-from pangukitsappdev.api.llms.base import LLMApi
+from pangukitsappdev.api.llms.base import LLMApi, ConversationMessage
 from pangukitsappdev.api.llms.llm_config import LLMParamConfig
 
 
 class Skill(ABC):
 
     @abstractmethod
     def execute(self, inputs: Dict[str, Any]) -> str:
         """
         执行Executor
         :param inputs: 输入的参数，基本上都是用来渲染prompt_template的
         :return: 执行结果，LLM的返回结果
         """
         pass
 
+    @staticmethod
+    def skill_llm_ask(prompt: Union[str, List[ConversationMessage]],
+                      llm_api: LLMApi,
+                      param_config: LLMParamConfig = None) -> str:
+        """
+        支持skill流式输出
+        :param prompt: 用户输入
+        :param llm_api: 模型api接口
+        :param param_config: 可选参数
+        :return: 执行结果，LLM的返回结果
+        """
+        if (param_config and param_config.stream) or llm_api.get_llm_config().llm_param_config.stream:
+            tokens = llm_api.ask(prompt, param_config)
+            answer = ""
+            for token in tokens:
+                answer += token
+        else:
+            answer = llm_api.ask(prompt, param_config).answer
+        return answer
+
 
 class SimpleSkill(Skill):
     """
     一个Executor的简单实现，传递prompt_template和llm_api两个参数即可，面向api包下面的接口编程
     """
 
     def __init__(self, prompt_template: BasePromptTemplate, llm_api: LLMApi):
         self.prompt_template = prompt_template
         self.llm_api = llm_api
 
     def execute(self, inputs: Dict[str, Any], param_config: LLMParamConfig = None) -> str:
         prompt = self.prompt_template.format(**inputs)
-        return self.llm_api.ask(prompt, param_config).answer
+        return self.skill_llm_ask(prompt, self.llm_api, param_config)
 
 
 class ChainWrappedSkill(Skill):
     """
     通过封装一个Chain来实现Executor，方便集成langchain预置的一些chain
     """
```

## pangukitsappdev/auth/__init__.py

```diff
@@ -0,0 +1,5 @@
+00000000: 2320 2043 6f70 7972 6967 6874 2028 6329  #  Copyright (c)
+00000010: 2048 7561 7765 6920 5465 6368 6e6f 6c6f   Huawei Technolo
+00000020: 6769 6573 2043 6f2e 2c20 4c74 642e 2032  gies Co., Ltd. 2
+00000030: 3032 332d 3230 3234 2e20 416c 6c20 7269  023-2024. All ri
+00000040: 6768 7473 2072 6573 6572 7665 642e 0a    ghts reserved..
```

## pangukitsappdev/auth/iam.py

```diff
@@ -27,14 +27,15 @@
         self.iam_url = iam_config.iam_url
         self.project_name = iam_config.project_name
         self.iam_domain = iam_config.iam_domain
         self.iam_pwd = iam_config.iam_pwd
         self.iam_user = iam_config.iam_user
         self.expire_duration_millis = iam_config.expire_duration_millis
         self.proxies = iam_config.http_config.requests_proxies()
+        self.x_auth_token = iam_config.x_auth_token
 
         # 当前的token，可能过期了
         self.__hold_token: str = ""
 
         # 在什么时间超时，一个时间戳
         self.__expired_at: int = -1
         # 什么时间创建的
@@ -115,14 +116,18 @@
     def get_valid_token(self):
         """获取有效token
         使用这个方法获取可用token，并在到期后自动刷新
         :return: iam认证token
         """
         if self.iam_disabled:
             return ""
+
+        if self.x_auth_token:
+            return self.x_auth_token
+
         if self.__expired_at and now_millis() > self.__expired_at:
             if self.iam_sk is not None and self.iam_ak is not None:
                 fresh_token = IAMTokenProvider.get_token_by_ak_sk(url=self.iam_url,
                                                                   access_key=self.iam_ak,
                                                                   secret_key=self.iam_sk,
                                                                   project_name=self.project_name,
                                                                   proxies=self.proxies)
```

## pangukitsappdev/cache/__init__.py

```diff
@@ -0,0 +1,5 @@
+00000000: 2320 2043 6f70 7972 6967 6874 2028 6329  #  Copyright (c)
+00000010: 2048 7561 7765 6920 5465 6368 6e6f 6c6f   Huawei Technolo
+00000020: 6769 6573 2043 6f2e 2c20 4c74 642e 2032  gies Co., Ltd. 2
+00000030: 3032 332d 3230 3234 2e20 416c 6c20 7269  023-2024. All ri
+00000040: 6768 7473 2072 6573 6572 7665 642e 0a    ghts reserved..
```

## pangukitsappdev/cache/in_memory.py

```diff
@@ -1,16 +1,13 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from typing import Any, Optional
 from cachetools import TTLCache, LRUCache
 
-try:
-    from langchain.schema.cache import BaseCache
-except ImportError:
-    from langchain.cache import BaseCache
-from langchain.cache import RETURN_VAL_TYPE
+from langchain.schema.cache import BaseCache
+from langchain.schema.cache import RETURN_VAL_TYPE
 
 from pangukitsappdev.api.memory.cache.base import CacheApiAdapter
 from pangukitsappdev.api.memory.cache.cache_config import CacheStoreConfig
 
 
 class InMemoryCacheApi(CacheApiAdapter):
```

## pangukitsappdev/cache/sql.py

```diff
@@ -1,10 +1,11 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from typing import Any, Optional
-from langchain.cache import SQLAlchemyCache, RETURN_VAL_TYPE
+from langchain.schema.cache import RETURN_VAL_TYPE
+from langchain.cache import SQLAlchemyCache
 from langchain.schema import Generation
 from sqlalchemy import Column, Integer, Text, String, create_engine, Engine, select, delete, make_url
 from sqlalchemy.orm import declarative_base, Session
 
 from pangukitsappdev.api.memory.cache.base import CacheApiAdapter
 from pangukitsappdev.api.memory.cache.cache_config import CacheStoreConfig
 from pangukitsappdev.utils.time_date import now_yyyyMMddHHmmss, now_sec, to_yyyyMMddHHmmss
```

## pangukitsappdev/cache/ttl_redis.py

```diff
@@ -1,11 +1,11 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from typing import Optional, Any
-
-from langchain.cache import RedisCache, RETURN_VAL_TYPE, RedisSemanticCache
+from langchain.schema.cache import RETURN_VAL_TYPE
+from langchain.cache import RedisCache, RedisSemanticCache
 from langchain.embeddings.base import Embeddings
 from redis import Redis
 
 from pangukitsappdev.api.memory.cache.base import CacheApiAdapter
 from pangukitsappdev.api.memory.cache.cache_config import CacheStoreConfig
```

## pangukitsappdev/embeddings/openai.py

```diff
@@ -1,9 +1,9 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
-from langchain.embeddings import OpenAIEmbeddings
+from langchain_openai import OpenAIEmbeddings
 from langchain.embeddings.base import Embeddings
 
 from pangukitsappdev.api.embeddings.base import AbstractEmbeddingApi
 from pangukitsappdev.api.embeddings.embedding_config import EmbeddingConfig
 
 
 class OpenAIEmbeddingApi(AbstractEmbeddingApi):
```

## pangukitsappdev/llms/gallery.py

```diff
@@ -11,15 +11,15 @@
 from langchain.llms.base import LLM, BaseLLM
 from langchain.schema import AIMessage, BaseMessage
 from langchain.schema.messages import AIMessageChunk
 from langchain.schema.output import GenerationChunk, LLMResult, Generation, ChatGeneration, ChatResult, \
     ChatGenerationChunk
 from requests.exceptions import ChunkedEncodingError
 
-from pangukitsappdev.api.llms.base import AbstractLLMApi, to_message_in_req, get_llm_params
+from pangukitsappdev.api.llms.base import AbstractLLMApi, get_llm_params, convert_message_to_req
 from pangukitsappdev.api.llms.llm_config import LLMConfig, LLMParamConfig
 from pangukitsappdev.auth.iam import IAMTokenProvider, IAMTokenProviderFactory
 from pangukitsappdev.llms.response.llm_response_gallery import LLMRespGallery
 from pangukitsappdev.llms.response.gallery_text_resp import GalleryUsage, GalleryTextResp, GalleryTextChoice
 from pangukitsappdev.api.common_config import AUTH_TOKEN_HEADER
 
 logger = logging.getLogger(__name__)
@@ -162,14 +162,15 @@
             "history": history
         }
         token = self.token_getter.get_valid_token()
         headers = {
             AUTH_TOKEN_HEADER: token,
             "X-Agent": "pangu-kits-app-dev"
         } if token else {"X-Agent": "pangu-kits-app-dev"}
+        logger.info("req: %s", json.dumps(request_body, ensure_ascii=False))
         rsp = requests.post(self.gallery_url, headers=headers,
                             json=request_body,
                             verify=False, stream=True, proxies=self.proxies)
         try:
             rsp.raise_for_status()
             stream_client: sseclient.SSEClient = sseclient.SSEClient(rsp)
             for event in stream_client.events():
@@ -206,14 +207,15 @@
             "history": history
         }
         token = self.token_getter.get_valid_token()
         headers = {
             AUTH_TOKEN_HEADER: token,
             "X-Agent": "pangu-kits-app-dev"
         } if token else {"X-Agent": "pangu-kits-app-dev"}
+        logger.info("req: %s", json.dumps(request_body, ensure_ascii=False))
         rsp = requests.post(self.gallery_url, headers=headers,
                             json=request_body,
                             verify=False, stream=False, proxies=self.proxies)
 
         if 200 == rsp.status_code:
             llm_output = rsp.json()
             text = llm_output["choices"][0]["text"]
@@ -223,25 +225,25 @@
             rsp.raise_for_status()
 
         return ChatResult(generations=generations, llm_output=llm_output)
 
     @staticmethod
     def _get_history(messages: List[BaseMessage]) -> List:
         # 第一个role开始作为问答对开始
-        while messages and to_message_in_req(messages[0]).get("role") != "user":
+        message_req = convert_message_to_req(messages)
+        while message_req and message_req[0].get("role") != "user":
             messages.pop(0)
 
-        if not messages:
+        if not message_req:
             raise ValueError("No input messages!")
         history = []
-        for i in range(0, len(messages) - 1, 2):
-            if to_message_in_req(messages[i]).get("role") != "user"\
-                    and to_message_in_req(messages[i + 1]).get("role") != "assistant":
+        for i in range(0, len(message_req) - 1, 2):
+            if message_req[i].get("role") != "user" and message_req[i+1].get("role") != "assistant":
                 raise ValueError("Illegal question and answer pair!")
-            history.append([messages[i].content, messages[i+1].content])
+            history.append([message_req[i].get("content"), message_req[i+1].get("content")])
         return history
 
 
 class GalleryLLMApi(AbstractLLMApi):
 
     def do_create_chat_llm(self, llm_config: LLMConfig) -> BaseChatModel:
         config_params = self._parse_llm_config(llm_config)
```

## pangukitsappdev/llms/openai.py

```diff
@@ -1,10 +1,10 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from langchain.llms.openai import OpenAI
-from langchain.chat_models.openai import ChatOpenAI
+from langchain_openai import ChatOpenAI
 from langchain.chat_models.base import BaseChatModel
 from langchain.llms.base import BaseLLM
 from langchain.schema import LLMResult
 
 from pangukitsappdev.api.llms.base import AbstractLLMApi
 from pangukitsappdev.api.llms.llm_config import LLMConfig
 from pangukitsappdev.llms.response.llm_response_openai import LLMRespOpenAI
```

## pangukitsappdev/llms/pangu.py

```diff
@@ -11,15 +11,15 @@
 from langchain.llms.base import LLM, BaseLLM
 from langchain.schema import BaseMessage, AIMessage, get_buffer_string
 from langchain.schema.messages import AIMessageChunk
 from langchain.schema.output import GenerationChunk, LLMResult, Generation, ChatGenerationChunk, ChatResult, \
     ChatGeneration
 from requests.exceptions import ChunkedEncodingError
 
-from pangukitsappdev.api.llms.base import AbstractLLMApi, to_message_in_req, get_llm_params
+from pangukitsappdev.api.llms.base import AbstractLLMApi, get_llm_params, ConversationMessage, convert_message_to_req
 from pangukitsappdev.api.llms.llm_config import LLMConfig
 from pangukitsappdev.auth.iam import IAMTokenProvider, IAMTokenProviderFactory
 from pangukitsappdev.llms.response.llm_response_pangu import LLMRespPangu
 from pangukitsappdev.llms.response.pangu_text_resp import PanguUsage, PanguTextResp, PanguTextChoice
 from pangukitsappdev.api.common_config import AUTH_TOKEN_HEADER
 
 logger = logging.getLogger(__name__)
@@ -146,15 +146,15 @@
     proxies: dict = {}
 
     def _generate(self, messages: List[BaseMessage], stop: Optional[List[str]] = None,
                   run_manager: Optional[CallbackManagerForLLMRun] = None, **kwargs: Any) -> ChatResult:
         generations = []
         llm_output = {}
         request_body = {
-            "messages": [to_message_in_req(message) for message in messages],
+            "messages": convert_message_to_req(messages),
             "stream": False,
             **get_llm_params({
                 "temperature": self.temperature,
                 "max_tokens": self.max_tokens,
                 "top_p": self.top_p,
                 "presence_penalty": self.presence_penalty,
                 "with_prompt": self.with_prompt
@@ -162,14 +162,15 @@
         }
 
         token = self.token_getter.get_valid_token()
         headers = {
             AUTH_TOKEN_HEADER: token,
             "X-Agent": "pangu-kits-app-dev"
         } if token else {"X-Agent": "pangu-kits-app-dev"}
+        logger.info("req: %s", json.dumps(request_body, ensure_ascii=False))
         rsp = requests.post(self.pangu_url + "/chat/completions", headers=headers,
                             json=request_body,
                             verify=False, stream=False, proxies=self.proxies)
 
         if 200 == rsp.status_code:
             llm_output = rsp.json()
             text = llm_output["choices"][0]["message"]["content"]
@@ -185,29 +186,30 @@
             messages: List[BaseMessage],
             stop: Optional[List[str]] = None,
             run_manager: Optional[CallbackManagerForLLMRun] = None,
             **kwargs: Any,
     ) -> Iterator[ChatGenerationChunk]:
 
         request_body = {
-            "messages": [to_message_in_req(message) for message in messages],
+            "messages": convert_message_to_req(messages),
             "stream": True,
             **get_llm_params({
                 "temperature": self.temperature,
                 "max_tokens": self.max_tokens,
                 "top_p": self.top_p,
                 "presence_penalty": self.presence_penalty,
                 "with_prompt": self.with_prompt
             })
         }
         token = self.token_getter.get_valid_token()
         headers = {
             AUTH_TOKEN_HEADER: token,
             "X-Agent": "pangu-kits-app-dev"
         } if token else {"X-Agent": "pangu-kits-app-dev"}
+        logger.info("req: %s", json.dumps(request_body, ensure_ascii=False))
         rsp = requests.post(self.pangu_url + "/chat/completions", headers=headers,
                             json=request_body,
                             verify=False, stream=True, proxies=self.proxies)
         try:
             rsp.raise_for_status()
             stream_client: sseclient.SSEClient = sseclient.SSEClient(rsp)
             for event in stream_client.events():
```

## pangukitsappdev/prompt/prompts/default/agent/react.pt

```diff
@@ -13,16 +13,18 @@
 Observation:Action返回的的结果
 ... (Thought/Action/Observation 迭代N次)
 Thought:我知道问题的答案了
 Action:{"action":"FINAL_ANSWER","actionInput":"结合用户的问题与Thought/Action/Observation，给出最终答案"}
 
 开始！返回必须包含一个Action，是一个合法的JSON。如有必要，请使用工具，且返回一个Action；如果不需要使用工具就能返回最终答案，请直接返回，且是一个FINAL_ANSWER Action。
 {% for message in messages %}{{message.role.desc}}：{{message.content}}
-{% endfor %}
-{% if actions | length > 0 %}
+{% if message.actions | length > 0 %}
+
 以下为你之前为了解决用户问题而进行的工作：
-{% for action in actions %}Thought:{{action.thought}}
+{% for action in message.actions %}Thought:{{action.thought}}
 Action:{{action.actionJson}}
 Observation:Action(action={{action.action}})返回如下，{{action.observation}}
 {% endfor %}
+请思考并返回下一步的Thought和Action。{% else%}进行推理，返回Thought和Action。{% endif%}
+{% endfor %}
 
-请思考并返回下一步的Thought和Action。{% else%}进行推理，返回Thought和Action。{% endif%}如果已经可以推理出最终答案，请返回一个FINAL_ANSWER Action。
+如果已经可以推理出最终答案，请返回一个FINAL_ANSWER Action。
```

## pangukitsappdev/prompt/prompts/default/agent/react_pangu.pt

```diff
@@ -1 +1 @@
-[unused9]系统：你是一个智能助手，你为用户生成综合质量（包括有用性，事实性，无害性）极好的回复。[unused10][unused9]系统：{{sys_prompt}}。[unused10]{{tool_desc}}{% for message in messages %}[unused9]{{message.role.desc}}：{{message.content}}[unused10]{% endfor %}{% for action in actions %}[unused9]助手：{{action.resp}}[unused10]{% if action.observation %}[unused9]工具:{{action.action}}|{{action.observation}}[unused10]{% endif %}{% if action.userFeedBack %}[unused9]用户:{{action.userFeedBack}}[unused10]{% endif %}{% endfor %}[unused9]助手：
+[unused9]系统：你是一个智能助手，你为用户生成综合质量（包括有用性，事实性，无害性）极好的回复。[unused10][unused9]系统：{{sys_prompt}}。[unused10]{{tool_desc}}{% for message in messages %}{% for action in message.actions %}{% if action.action != "FINAL_ANSWER" %}[unused9]助手：{{action.resp}}[unused10]{% endif %}{% if action.observation %}[unused9]工具:{{action.action}}|{{action.observation}}[unused10]{% endif %}{% if action.userFeedBack %}[unused9]用户:{{action.userFeedBack}}[unused10]{% endif %}{% endfor %}{% if message.content %}[unused9]{{message.role.desc}}：{{message.content}}[unused10]{% endif %}{% endfor %}[unused9]助手：
```

## pangukitsappdev/prompt/prompts/default/agent/react_pangu_2.pt

```diff
@@ -1 +1 @@
-[unused9]系统：你是一个智能助手，你为用户生成综合质量（包括有用性，事实性，无害性）极好的回复。[unused10][unused9]系统：你可以调用各种用户自定义的工具来解决用户的问题。{{sys_prompt}}。你可以使用如下工具：{{tool_desc}}[unused10]{% for message in messages %}[unused9]{{message.role.desc}}：{{message.content}}[unused10]{% endfor %}{% for action in actions %}[unused9]助手：{{action.resp}}[unused10]{% if action.observation %}[unused9]工具:{{action.action}}|{{action.observation}}[unused10]{% endif %}{% if action.userFeedBack %}[unused9]用户:{{action.userFeedBack}}[unused10]{% endif %}{% endfor %}[unused9]助手：
+[unused9]系统：你是一个智能助手，你为用户生成综合质量很好的回复。[unused10][unused9]系统：你可以调用各种用户自定义的工具来解决用户的问题。{{sys_prompt}}。可使用工具：{{tool_desc}}[unused10]{% for message in messages %}{% for action in message.actions %}{% if action.action != "FINAL_ANSWER" %}[unused9]助手：{{action.resp}}[unused10]{% endif %}{% if action.observation %}[unused9]工具:{{action.action}}|{{action.observation}}[unused10]{% endif %}{% if action.userFeedBack %}[unused9]用户:{{action.userFeedBack}}[unused10]{% endif %}{% endfor %}{% if message.content %}[unused9]{{message.role.desc}}：{{message.content}}[unused10]{% endif %}{% endfor %}[unused9]助手：
```

## pangukitsappdev/skill/agent_session_skill.py

```diff
@@ -1,29 +1,33 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2024. All rights reserved.
+from pydantic.utils import deepcopy
 from pangukitsappdev.prompt.prompt_tmpl import PromptTemplates
 
 from pangukitsappdev.agent.agent_session import AgentSession
 from pangukitsappdev.api.llms.base import LLMApi
 from pangukitsappdev.api.skill.base import Skill, SimpleSkill
 
 
 class AgentSessionSkill(Skill):
     """
     对Agent的Session进行总结，得出问题的最终答案
     """
 
-    def __init__(self, llm_api: LLMApi):
-        self.llm_api = llm_api
+    def __init__(self, llm: LLMApi):
+        self.llm = llm
 
     def summary(self, session: AgentSession) -> str:
-        history_action = session.history_action
+        history_action = session.current_message.actions
         if not history_action:
             return ""
         # 如果只包含一轮，则直接返回
         if len(history_action) == 1:
-            return session.final_answer
+            return session.current_message.content
         # 如果包含多轮则进行总结
-        summary_skill = SimpleSkill(PromptTemplates.get("skill_agent_session_summary"), self.llm_api)
-        return summary_skill.execute({"messages": session.messages, "actions": session.history_action})
+        summary_skill = SimpleSkill(PromptTemplates.get("skill_agent_session_summary"), self.llm)
+        messages = deepcopy(session.messages)
+        if messages[-1].role.text == "assistant":
+            messages.pop()
+        return summary_skill.execute({"messages": session.messages, "actions": history_action})
 
     def execute(self, session: AgentSession) -> str:
         return self.summary(session)
```

## pangukitsappdev/skill/conversation_rewrite_skill.py

```diff
@@ -1,12 +1,11 @@
 #  Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
 from typing import List
-from langchain.schema import BaseMessage
 from pangukitsappdev.api.skill.base import SimpleSkill
-from pangukitsappdev.api.llms.base import LLMApi
+from pangukitsappdev.api.llms.base import LLMApi, ConversationMessage
 from pangukitsappdev.prompt.prompt_tmpl import PromptTemplates
 from langchain.prompts import PromptTemplate
 import logging
 
 logger = logging.getLogger(__name__)
 
 
@@ -15,12 +14,12 @@
     def __init__(self, llm: LLMApi):
         self.llm = llm
         self.prompt = PromptTemplates.get("skill_conversation_rewrite")
 
     def set_prompt(self, prompt_template: str):
         self.prompt = PromptTemplate.from_template(prompt_template, template_format="jinja2")
 
-    def rewrite(self, messages: List[BaseMessage]) -> str:
+    def rewrite(self, messages: List[ConversationMessage]) -> str:
         query_write = SimpleSkill(self.prompt, self.llm)
         rewrite_result = query_write.execute({"messages": messages})
         logger.info("ConversationRewrite result: %s", rewrite_result)
         return rewrite_result
```

## pangukitsappdev/skill/conversation_skill.py

```diff
@@ -15,15 +15,15 @@
         INPUT = "input"
         OUTPUT = "output"
 
     def execute_dict(self, inputs: Dict[str, Any]) -> str:
         if self.PromptParam.MEMORY_HISTORY in inputs:
             del inputs[self.PromptParam.MEMORY_HISTORY]
         inputs.update(self.memory.load_memory_variables({}))
-        answer = self.llm.ask(self.prompt.format(**inputs)).answer
+        answer = self.skill_llm_ask(self.prompt.format(**inputs), self.llm)
         self.memory.save_context({self.PromptParam.INPUT: inputs.get(self.PromptParam.INPUT)},
                                  {self.PromptParam.OUTPUT: answer})
         return answer
 
     def __init__(self, llm: LLMApi):
         self.llm = llm
         self.memory = ConversationBufferMemory()
```

## pangukitsappdev/skill/doc/base.py

```diff
@@ -52,17 +52,17 @@
     """
 
     def __init__(self, prompt_template: BasePromptTemplate, llm_api: LLMApi):
         self.prompt_template = prompt_template
         self.llm_api = llm_api
 
     def execute_with_docs(self, docs: List[Document], question: str = None) -> str:
-        return self.llm_api.ask(
-            self.prompt_template.format(**{DOCUMENTS_VAR_KEY: [{"pageContent": d.page_content} for d in docs],
-                                           QUESTION_VAR_KEY: question})).answer
+        prompt = self.prompt_template.format(**{DOCUMENTS_VAR_KEY: [{"pageContent": d.page_content} for d in docs],
+                                                QUESTION_VAR_KEY: question})
+        return self.skill_llm_ask(prompt, self.llm_api)
 
 
 class DocRefineSkill(AbstractDocSkill):
     """
     refine策略
 
     Attributes:
@@ -74,26 +74,26 @@
     def __init__(self, qa_prompt: BasePromptTemplate, refine_prompt: BasePromptTemplate, llm_api: LLMApi):
         self.qa_prompt = qa_prompt
         self.refine_prompt = refine_prompt
         self.llm_api = llm_api
 
     def execute_with_docs(self, docs: List[Document], question: str = None) -> str:
         prompt = self.qa_prompt.format(document=docs[0].page_content, question=question)
-        answer = self.llm_api.ask(prompt).answer
+        answer = self.skill_llm_ask(prompt, self.llm_api)
 
         logger.debug("Refine policy first answer %s", answer)
 
         if len(docs) == 1:
             return answer
 
         for doc in docs[1:]:
             refine_prompt = self.refine_prompt.format(document=doc.page_content,
                                                       question=question,
                                                       answer=answer)
-            answer = self.llm_api.ask(refine_prompt).answer
+            answer = self.skill_llm_ask(refine_prompt, self.llm_api)
             logger.debug("Refine policy refined answer: %s", answer)
 
         return answer
 
 
 class DocMapReduceSkill(AbstractDocSkill):
     """MapReduce策略
@@ -112,25 +112,25 @@
         self.reduce_prompt = reduce_prompt
         self.llm_api = llm_api
         self.reduce_max_token = reduce_max_token
 
     def execute_with_docs(self, docs: List[Document], question: str = None) -> str:
         def map_doc(doc: Document) -> Document:
             prompt = self.map_prompt.format(document=doc.page_content, question=question)
-            answer = self.llm_api.ask(prompt).answer
+            answer = self.skill_llm_ask(prompt, self.llm_api)
             logger.debug("policy: mapreduce, document is: %s", doc.page_content)
             logger.debug("policy: mapreduce, map answer is: %s", answer)
             return Document(page_content=answer)
 
         def format_reduce(docs_group: List[Document]) -> str:
             return self.reduce_prompt.format(summaries=[{"pageContent": d.page_content} for d in docs_group],
                                              question=question)
 
         def reduce_docs(docs_group: List[Document]) -> str:
-            return self.llm_api.ask(format_reduce(docs_group)).answer
+            return self.skill_llm_ask(format_reduce(docs_group), self.llm_api)
 
         mapped_docs = [map_doc(doc) for doc in docs]
 
         while len(format_reduce(mapped_docs)) > self.reduce_max_token:
             docs_groups = []
             sub_docs = []
             for doc in mapped_docs:
```

## Comparing `pangu_kits_app_dev_py-2.0.0.dist-info/METADATA` & `pangu_kits_app_dev_py-2.1.0.dist-info/METADATA`

 * *Files 12% similar despite different names*

```diff
@@ -1,29 +1,30 @@
 Metadata-Version: 2.1
 Name: pangu-kits-app-dev-py
-Version: 2.0.0
+Version: 2.1.0
 Summary: App development kit for Pangu
 Classifier: Topic :: Software Development :: Libraries :: Application Frameworks
 Classifier: Development Status :: 3 - Alpha
 Classifier: Intended Audience :: Developers
 Classifier: Programming Language :: Python :: 3.9
 Requires-Python: >=3.7
-Requires-Dist: langchain <=0.0.325
-Requires-Dist: langchain >=0.0.245
+Requires-Dist: langchain ~=0.1.11
 Requires-Dist: jinja2 ~=3.1.2
 Requires-Dist: requests >=2.31.0
 Requires-Dist: pydantic ~=1.10.9
 Requires-Dist: python-dotenv ~=0.21.0
 Requires-Dist: sseclient-py ~=1.7.2
 Requires-Dist: elasticsearch ~=7.6.0
 Requires-Dist: urllib3 ~=1.26.16
 Requires-Dist: cachetools ~=5.3.1
 Provides-Extra: gptcache
 Requires-Dist: gptcache ~=0.1.37 ; extra == 'gptcache'
 Requires-Dist: redis ~=4.5.5 ; extra == 'gptcache'
 Requires-Dist: redis-om ~=0.1.3 ; extra == 'gptcache'
+Provides-Extra: langchain-openai
+Requires-Dist: langchain-openai ~=0.0.8 ; extra == 'langchain-openai'
 Provides-Extra: redis
 Requires-Dist: redis ~=4.5.5 ; extra == 'redis'
 Provides-Extra: sqlcache
 Requires-Dist: pymysql ~=1.1.0 ; extra == 'sqlcache'
 Requires-Dist: SQLAlchemy ~=2.0.19 ; extra == 'sqlcache'
```

## Comparing `pangu_kits_app_dev_py-2.0.0.dist-info/RECORD` & `pangu_kits_app_dev_py-2.1.0.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,72 +1,72 @@
 pangukitsappdev/__init__.py,sha256=D7n19KsVslhQvQq-emBvEDQXP-sT1oH20XdCCAw7EBk,210
 pangukitsappdev/agent/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/agent/agent_action.py,sha256=jy1vyg7mOxybeOTnqezXeKR1RcVgzIfwwbPGfj3rJ-U,938
-pangukitsappdev/agent/agent_session.py,sha256=Pwky35HG3e3noHRhSSXxpHiMjJv_uK1aLKy8yJ4e2FM,951
-pangukitsappdev/agent/react_agent.py,sha256=w6uH0DT0-PomWxKRHKDyT7MWQmKpnSx_vdlYMLanPM8,7441
-pangukitsappdev/agent/react_pangu_agent.py,sha256=SQuKO9np-uvcpu_JqRT9F8ln8w9NdUIXwspmVrP2ves,9995
+pangukitsappdev/agent/agent_action.py,sha256=KU-YwrI6GcIsTvBvyC-RPZ8AZnKATIXATsrT8gi3-DE,890
+pangukitsappdev/agent/agent_session.py,sha256=KJL0e3zF1YABRaIcOb9JKHkwRRx8DnAhJMqvMCrPqrU,888
+pangukitsappdev/agent/react_agent.py,sha256=GkSG6uYSWA0KNy6bSkZiMMLQ8Wy9YDKa0Jxl_leIwyI,6604
+pangukitsappdev/agent/react_pangu_agent.py,sha256=ZUAy8Ibb7jRVCfdTxnzfR8cmPpRcVyy2vKDMu5_g0yU,9127
 pangukitsappdev/api/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/api/common_config.py,sha256=TN2Jk3QQ6dCpdgtcVFaXsqoyO-yCZlbABQrCxjyuJEY,4713
+pangukitsappdev/api/common_config.py,sha256=mQDgq7Ewg6tYaL1EDrAJdtbErv41TKiMjJLyl5vVmAY,4773
 pangukitsappdev/api/config_loader.py,sha256=WWM8fsP9X8umOrFekP6mtHLUUWgpod5CvykIvMUQG_s,8007
 pangukitsappdev/api/crypto_util.py,sha256=5-IweA2Fi9i8-woyR-D9NUW0TifTelqRlBgFIZmWpzM,2857
 pangukitsappdev/api/schema.py,sha256=tj2dxdl3LDNCRo1KuMwK2mK8SDD791ykkuBRUYLIGX0,260
 pangukitsappdev/api/agent/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/api/agent/base.py,sha256=kn8xGlgLfWB9ABdMS9Zw-ddEEb8IN3Qkp-3lC8qVN-4,20212
+pangukitsappdev/api/agent/base.py,sha256=zD5W9EBj5hVcOFxD-TBBuN9jnIrj_Lim7bCUSdX3SSU,22187
 pangukitsappdev/api/doc_split/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/api/doc_split/base.py,sha256=WZRATD94xL6Q9S2hXQNOGsWEp3DmO1I-HgdwqXu5_CM,984
 pangukitsappdev/api/doc_split/factory.py,sha256=UKoo1lG5sHUZvHAX5bK8l8_eHGncsAlL99NIlvOjXYs,1648
 pangukitsappdev/api/doc_split/split_config.py,sha256=t6TTLj06pLVAyiY_YE53swo6fhD76Faskbpa1_H_YZk,1276
 pangukitsappdev/api/embeddings/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/api/embeddings/base.py,sha256=PxzrF1I_cbnngFQHlkS3JWavcoqehdLokrfVBvblryY,1634
 pangukitsappdev/api/embeddings/embedding_config.py,sha256=VnEy3A8jTanaXXPzM8lPdcsGIDy0M4RCwdxEfXOyZHw,963
 pangukitsappdev/api/embeddings/factory.py,sha256=-jcaMDBnusNuaNC71hE2PZUW3-1SIL3d2QTSViXzQIw,2490
 pangukitsappdev/api/llms/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/api/llms/base.py,sha256=npJwtmthYmvFpYAWQDR8qM8Jw5aherFWWnkGXnvA0tU,10915
+pangukitsappdev/api/llms/base.py,sha256=RCbNhHOeAu5vj5chYhNrxeHYjJ_P7TjlUdBdiBDnycg,11476
 pangukitsappdev/api/llms/factory.py,sha256=oEm9GV4nWDeeJj0NwDBx52bdgwWM8SsEDtT5lydv6rk,2521
 pangukitsappdev/api/llms/llm_config.py,sha256=Bqm-S8NAHToYWgX2ZYUz4oGj65waLLDGjcRHy2HuV6w,5710
 pangukitsappdev/api/memory/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/api/memory/message_history_config.py,sha256=yYK3b4gCHPLX2vDo61NBuHodvxdupsS-fKtV-pfPYOE,1068
 pangukitsappdev/api/memory/cache/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/api/memory/cache/base.py,sha256=dD5vk33T9euEaykin9wcApZqC2Tt6aNCbh59rTUk90M,1858
+pangukitsappdev/api/memory/cache/base.py,sha256=0DZtrHZR3QcMZcc8iCeBDeyYYrnoDpvYU2cnlxz90nY,1864
 pangukitsappdev/api/memory/cache/cache_config.py,sha256=uF36so77oGTFelB-L0PWrVLR1ALHCXcJQeyD_xYKTpc,2836
 pangukitsappdev/api/memory/cache/factory.py,sha256=FpOXIAz7ClraVHxCg3CwmTWzqTynhA6L3zHun40q9sY,2780
 pangukitsappdev/api/memory/vector/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/api/memory/vector/base.py,sha256=Swc85xaAnOvTJu4WB7-2aW7IPozBFWl2dQlv9LWDKkY,4295
 pangukitsappdev/api/memory/vector/factory.py,sha256=sDDmapSCbTtrsmmbS9aG7W7uOQQpwib6F0SJVjy-f8U,2025
 pangukitsappdev/api/memory/vector/vector_config.py,sha256=jgTUiqRN8iW3SJTGoWIU_rPbHHAKLEBD4cpFK2Zh9jw,2093
 pangukitsappdev/api/prompt/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/api/prompt/prompt_config.py,sha256=jJSoOB_zS_M4CWG4kJvkJqqR86JK2aGcQDhlclid3pg,4486
 pangukitsappdev/api/retriever/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/api/retriever/base.py,sha256=jLJdL1UhiFK8U7SlyuX7p9KnxNU4Znds24bdiNdEGwI,4645
+pangukitsappdev/api/retriever/base.py,sha256=PWccXIotEu8Cu4m6e2uxrXdnhYu52b27YRo8F1oSTnc,4633
 pangukitsappdev/api/retriever/retriever_config.py,sha256=N-faLckiTwVhuVfbht_HP-iWSjDjZMU6yPQWIntCVok,757
 pangukitsappdev/api/skill/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/api/skill/base.py,sha256=XxANe95Kt_KM0eoDEt6KjlSxe7ZRixhBrRypeXwc63I,1654
+pangukitsappdev/api/skill/base.py,sha256=hDB5M0kh449ZYgoo0PbZCeZVS9QOQy7g8dqTQizZ15s,2461
 pangukitsappdev/api/skill/factory.py,sha256=GtqW-YW0dtgHWc7GQvSaujvJP22atrHtY-P4nnXtOGQ,640
 pangukitsappdev/api/tool/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/api/tool/base.py,sha256=uUmVwO7ijWFMrUeE2ubLbB0yAPFBFl7n01EnqC2y6lM,3202
-pangukitsappdev/auth/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-pangukitsappdev/auth/iam.py,sha256=6qv1rygc5kfgJEJDUlz19Yv-o5hhlQL6TE_dM8CPZ_4,5998
-pangukitsappdev/cache/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+pangukitsappdev/auth/__init__.py,sha256=i95SeUCQdTRayhX-0X10IcgP6v6JT_GuUkfAr8c5-eY,79
+pangukitsappdev/auth/iam.py,sha256=93hg9V-Nv95iOZfgkPOyeLHUBX4nWbiNUwarwG6o2C0,6119
+pangukitsappdev/cache/__init__.py,sha256=i95SeUCQdTRayhX-0X10IcgP6v6JT_GuUkfAr8c5-eY,79
 pangukitsappdev/cache/gptcache_adapter.py,sha256=VMFP8v7-M8m_Y3Fr2LBJfT_LNGiUUWKU9uNmwz1F0Ys,6087
-pangukitsappdev/cache/in_memory.py,sha256=gcTJqMLAJavb0U_WsG2lWIp3wIXh6CzMCkr9eZl4lWA,1626
-pangukitsappdev/cache/sql.py,sha256=kH6kneZfIiV7yovhx--AvAu7PWTqXl-WxRj9BgCTb-E,5086
-pangukitsappdev/cache/ttl_redis.py,sha256=SlqLTdI1flG8DMcU6Czu5-odJ9_Z2NHSaG95xM5Zw7M,3708
+pangukitsappdev/cache/in_memory.py,sha256=efxdS0uZIVOmYKS05S76LaBAIvx9ZWVUapTETE15ZeU,1562
+pangukitsappdev/cache/sql.py,sha256=j2OTpS-jfgnRk818FzAz7pOinvZR-ak19Ejhyr7UFcA,5120
+pangukitsappdev/cache/ttl_redis.py,sha256=OMIaxsZmAHWea4rtJhgU6vSsycfd7ZeokcvXSPt5xkM,3741
 pangukitsappdev/callback/DebugConsoleCallbackHandler.py,sha256=nAi7pf7U9CvURoSsJyFKRUfcfZtG-uT4RR7wI47zVs0,828
 pangukitsappdev/callback/StreamCallbackHandler.py,sha256=EP4-kl_AjjTd54-E8vryHBeE-0bTLbo-MemKC16bSe0,1230
 pangukitsappdev/callback/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 pangukitsappdev/doc_split/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/doc_split/pangu_split.py,sha256=l-BONEfDSc7Yb9NJXJRn_mKhj6ND0EscMx1tQOEpUVM,3525
 pangukitsappdev/embeddings/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/embeddings/openai.py,sha256=rb5D0R3qkD0OTb5wWPJZ2nviyZ24zjAdRwVpWJdu3EA,1026
+pangukitsappdev/embeddings/openai.py,sha256=RMIiiSj1L1D9gM6yHurNm3YdCZsaOKGNW3r1FQpf-54,1022
 pangukitsappdev/embeddings/pangu.py,sha256=OKYjcJbFOzXxuz1umJZyPNjGK2nIslzDS3Tbn7480QI,4767
 pangukitsappdev/embeddings/tool.py,sha256=JKQj7LzyRPqtoM3sYjKjfEAFGHtR3z1_w5A5HCC8D7A,1776
 pangukitsappdev/llms/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/llms/gallery.py,sha256=pktncHgNdnUnswIKAQdNoQOVGGuHJf8GxGD72x2SSzM,11922
-pangukitsappdev/llms/openai.py,sha256=VjSYQIl9l5DYs6kAHDgEIIYsODmLSHhbszcgSSdDPRs,2703
-pangukitsappdev/llms/pangu.py,sha256=L1oqDn9RPIUng-htghnJLIZn1FqDs-SnxukK4TeabEI,12941
+pangukitsappdev/llms/gallery.py,sha256=c1-2fhsShG9o6Vft25D_ca6lmfv0RCkJJ6_g5NfUxp8,12094
+pangukitsappdev/llms/openai.py,sha256=8HSVLGGMv5tRoyaNAOQmW5SlKo_Vcf6l7bufMA7G_ac,2691
+pangukitsappdev/llms/pangu.py,sha256=QhjNkWEbVHF983HGuZ98_sX-jGB1OnwuVV-KNIDnN_8,13081
 pangukitsappdev/llms/response/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/llms/response/gallery_text_resp.py,sha256=CVARm0IvIH_Qo1LFsTOcKiVuzGdbaRK0-TeqMPj9HLY,1225
 pangukitsappdev/llms/response/llm_response_gallery.py,sha256=U0sAiAMoJkEq_EG8OTyA5lpg_Ysu_xPzOWx2We7UkNQ,391
 pangukitsappdev/llms/response/llm_response_openai.py,sha256=94LgEDYPmM7CVzwKbLxxG_0_603L9C0K9tOsxCFVCSg,384
 pangukitsappdev/llms/response/llm_response_pangu.py,sha256=AL9l2Jr5HXESODEzUOVzEWuZHiiabbfwWkjRYbWJuS4,378
 pangukitsappdev/llms/response/openai_text_resp.py,sha256=GQAmYI8OuXm1oNjPYiQeuqeCvNN7-y-fZ7GoN5gnesE,778
 pangukitsappdev/llms/response/pangu_text_resp.py,sha256=gXAOExIKoEpJ2KXpVLFoGTgQdsXs7405qqk1MYrK738,1203
@@ -75,17 +75,17 @@
 pangukitsappdev/memory/redis_message_history.py,sha256=h9hLosDn34v2rz2ISk1yFYirORNH6cD6tKe3_wFNd3Q,1024
 pangukitsappdev/memory/sql_message_history.py,sha256=UFW2U928h2d8UVZYsq3SzyMk1X9s1qSTC19dat3t4_g,4229
 pangukitsappdev/prompt/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/prompt/prompt_tmpl.py,sha256=CvjYiVv2v9j_pKjqdge4ooEgphvsYarQDMHY3VlBdPc,3192
 pangukitsappdev/prompt/prompts/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/prompt/prompts/default/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/prompt/prompts/default/agent/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/prompt/prompts/default/agent/react.pt,sha256=0g7MaIN7hjyPtt_tbx3LC5kdN3-haUzjxmjI_bs6YKc,1463
-pangukitsappdev/prompt/prompts/default/agent/react_pangu.pt,sha256=95L_vG_Ehe0B41oLjw4N6hKwx_JOyUwaMWZBAx-7Hbo,601
-pangukitsappdev/prompt/prompts/default/agent/react_pangu_2.pt,sha256=kKG-0t_ip5Di5QP0tf15vVypWInmNBTPVGWVB8-qND8,703
+pangukitsappdev/prompt/prompts/default/agent/react.pt,sha256=Bub5BjfSgF98ccyVq6SDyMA82RJDAM4NTuWs89B-0GA,1481
+pangukitsappdev/prompt/prompts/default/agent/react_pangu.pt,sha256=FBPYPrTKTg9kApdFeEOIn_1ZmTdHZcJMByCddzO8Yhk,695
+pangukitsappdev/prompt/prompts/default/agent/react_pangu_2.pt,sha256=uwwmG4-3tsMwc1eTpVnOPdrRpNQAep__roNwrYsx3dU,740
 pangukitsappdev/prompt/prompts/default/agent/react_pangu_unify.pt,sha256=bf2VfoATySU6K8mQyAFQRt3HpAv0VF4toWSz86kaxtA,709
 pangukitsappdev/prompt/prompts/default/agent/tool_desc.pt,sha256=6zoR-eQe3bNvoCzk9QhuEmrtyWuDVgtQOUGJZvY4RSM,188
 pangukitsappdev/prompt/prompts/default/agent/tool_desc_pangu.pt,sha256=uvAuY4QbvHA5voo2Y2dikiPJ8CUSCwgBfeWOPCHGHj0,116
 pangukitsappdev/prompt/prompts/default/agent/tool_desc_pangu_2.pt,sha256=bf-RE23pJ0Rj3TNdhT_-ad2-tovftlJlZ0ro1qMwmgk,58
 pangukitsappdev/prompt/prompts/default/agent/tool_json_schema.pt,sha256=6zKPL7f39BEmVyGJAkXA1a5xwb7-s8-fp9A2bLLI42c,68
 pangukitsappdev/prompt/prompts/default/agent/tool_simple_schema.pt,sha256=kNlGDEeaO9gd84vMj5bs7elrg0pswud2PyhpUNaonyk,25
 pangukitsappdev/prompt/prompts/default/conversation/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
@@ -121,22 +121,22 @@
 pangukitsappdev/retriever/css_tool_retriever.py,sha256=VRJNrsSVlQIhZhLbNvM9PMGYqUSXULzCufR1cESOQco,1666
 pangukitsappdev/retriever/kg_retriever.py,sha256=9a96jKc2YsVqhFli6uP02ekT5oxOyJDaNYiIHH-V1iY,547
 pangukitsappdev/retriever/retrieved_tool.py,sha256=WPPd1jtMsOLNKNMqrREi6UylAa8l-uMSE-Ljc6lowc8,318
 pangukitsappdev/retriever/tool_metadata.py,sha256=MhRko5fpUEfYCwWmiSvKNUA4hS_x9QlQgGLEe2UCYn4,417
 pangukitsappdev/retriever/tool_retriever_impl.py,sha256=r3BzMoTPRZou4jeFe0TgIQl75zomhPeZqWcatMx4b1I,1623
 pangukitsappdev/retriever/web_retirever.py,sha256=mzO3OPRaYj3lqHv0Yyp8MUUM7FdA2rggNHBoEBx_xa8,410
 pangukitsappdev/skill/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
-pangukitsappdev/skill/agent_session_skill.py,sha256=Is4hxtcA-viqMZp03Cypl4ZfIWzTdLVQ-OfcbImBa24,1126
-pangukitsappdev/skill/conversation_rewrite_skill.py,sha256=PqMjWCfGhQ3CNuIR3gys_FdWSf2faFUzymR86rbqwso,1005
-pangukitsappdev/skill/conversation_skill.py,sha256=t_LjU_8Go_WATJNDczbgS89qgd2OEXh0NyRnok11LXE,1584
+pangukitsappdev/skill/agent_session_skill.py,sha256=1P2C5zsEQ4mCdWKtTL69ZpunnABXco9uyETcG79Ed_w,1281
+pangukitsappdev/skill/conversation_rewrite_skill.py,sha256=fCBA1DIIur_KabXQvbmgvj9gFXz9z5QpTfBfOdU-ydw,993
+pangukitsappdev/skill/conversation_skill.py,sha256=GkYV6-OqOacsQGaP1zBvHUWIYcHMtQ3tbZqDkcSWKrM,1593
 pangukitsappdev/skill/factory.py,sha256=aOUr5mX6OiBwRmO29qiPS6yRfSwvhCxp_KIFgeJ-OUA,1225
 pangukitsappdev/skill/qa_with_sources.py,sha256=-Xc0afn139bQMi83UmLuXmmxl7LXzWo_391UvEKt2yw,395
 pangukitsappdev/skill/doc/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/skill/doc/ask.py,sha256=-xHG5NI609SUXtz5NRjzsZFVRXgskB3sVQYj8rTFmFo,1001
-pangukitsappdev/skill/doc/base.py,sha256=9Ogtcw-7lsvG09IoOMrvx6z_-UeEHK9f-SHbIpDK_14,5631
+pangukitsappdev/skill/doc/base.py,sha256=6ypaZtjWQllef7cr_cZjGspKjBQluraQ7bnvnKqmnUk,5692
 pangukitsappdev/skill/doc/summary.py,sha256=6ifuJ-nMsx8leqAO2olq7j2TKiCEVD-BrlzgrYjjaVA,1065
 pangukitsappdev/stores/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 pangukitsappdev/stores/obs_store.py,sha256=PW2dyA3OMQLacMmdpvBpZ6ukMIr7NKc0YH2EPz5XxAM,8170
 pangukitsappdev/tool/__init__.py,sha256=9nw6A1uAZszjM1uH_NTuKmO1cPHgy7yxSoSlyg9FXHA,79
 pangukitsappdev/tool/in_memory_tool_provider.py,sha256=Q3pVSGPy4PiEcF-s6Y6UxPZTSeW-HdgJ_Uh6iJH0vt0,1133
 pangukitsappdev/tool/python_sandbox.py,sha256=9-lqr5PMFBdqpaq3aDB-AnkBsnJCMNo19LAxehOVOuY,335
 pangukitsappdev/tool/tool.py,sha256=SIf9plIKAYkOEk3LFdcTdSb-YNvrDmpSJllJR5xU4SA,5064
@@ -155,11 +155,11 @@
 pangukitsappdev/utils/security_util.py,sha256=ym43Zy2r_vcNIP1JoylKmD2yc4cUxMid7orvVL0JU5I,1094
 pangukitsappdev/utils/time_date.py,sha256=vDe0bCqqz6A4F9rIY3SnWLLRd3XmARZTn_e1AVgIxrc,929
 pangukitsappdev/vectorstores/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 pangukitsappdev/vectorstores/adapter.py,sha256=u-l8xpxiMLFHVR7GSB2oRa3qh9Ub90uRL1LM7Efqop8,1109
 pangukitsappdev/vectorstores/bulk_data.py,sha256=CWWIov8vafhPQ6BfHtKgclxVgnOUZvPuXcTDYwhUJ3I,324
 pangukitsappdev/vectorstores/css_store.py,sha256=jHtjyHXnvvmMpbvB2cqXkhe3DMiPCm9X5X67t-VVrQ0,16585
 pangukitsappdev/vectorstores/proxy_http_requests.py,sha256=YL31vnxRdUsTaTsmKZ6oiDScI9vKBCMHj-nr6Sb2pW4,592
-pangu_kits_app_dev_py-2.0.0.dist-info/METADATA,sha256=GWZn9xVhT69xScx1c4qnMPnJjApdfLwzRP0L4vlW5Ow,1081
-pangu_kits_app_dev_py-2.0.0.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
-pangu_kits_app_dev_py-2.0.0.dist-info/top_level.txt,sha256=I2DTXxdfkdqi-Ckn7IiancyO_honKKS8BSVzSP5s7oc,16
-pangu_kits_app_dev_py-2.0.0.dist-info/RECORD,,
+pangu_kits_app_dev_py-2.1.0.dist-info/METADATA,sha256=X1J3wjCHOUb5hTv04n2EV7UhZyrGFss85LYVP1ZmNUc,1148
+pangu_kits_app_dev_py-2.1.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+pangu_kits_app_dev_py-2.1.0.dist-info/top_level.txt,sha256=I2DTXxdfkdqi-Ckn7IiancyO_honKKS8BSVzSP5s7oc,16
+pangu_kits_app_dev_py-2.1.0.dist-info/RECORD,,
```

